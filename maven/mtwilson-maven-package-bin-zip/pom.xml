<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>


    <artifactId>mtwilson-maven-package-bin-zip</artifactId>
    <groupId>com.intel.mtwilson.maven</groupId>
    <packaging>pom</packaging>
    <description>Describes how to create an application zip file</description>

    <parent>
        <groupId>com.intel.mtwilson.maven</groupId>
        <artifactId>mtwilson-maven-root</artifactId>
        <version>3.0-SNAPSHOT</version>
        <relativePath />
    </parent>

    <build>
        <!-- NOTE: the order of plugins listed here is important because
        when multiple plugins have the same phase, maven 3.0.3 and later
        executes them in the order listed in the pom.  so first we create
        the jar, then we copy all resources in to the application directory,
        then we create the zip file. -->
        
        <plugins>
            
            <!-- generate the [project].jar containing the application.properties resource for the launcher -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
            </plugin>
                    
            <!-- copy the application directories and also the jar generated by compiler plugin for later packaging -->
            <plugin>
                <artifactId>maven-resources-plugin</artifactId>
                <version>2.7</version>
                <executions>
                    <execution>
                        <id>copy-application-directories</id>
                        <phase>package</phase>
                        <goals>
                            <goal>copy-resources</goal>
                        </goals>
                        <configuration>
                            <outputDirectory>${project.build.directory}/application</outputDirectory>
                            <resources>
                                <resource>
                                    <directory>src/main/application</directory>
                                    <filtering>false</filtering>
                                </resource>
                            </resources>
                        </configuration>            
                    </execution>
                </executions>
            </plugin>

            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-antrun-plugin</artifactId>
                <executions>
                    <execution>
                        <id>default-cli</id>
                        <phase>package</phase>
                        <goals>
                            <goal>run</goal>
                        </goals>
                        <configuration>
                            <target>
                                <mkdir dir="${project.build.directory}/application"/>
                                <zip destfile="${project.build.directory}/${project.artifactId}-${project.version}.zip" whenempty="create">
                                    <fileset dir="${project.build.directory}/application" />
                                </zip>
                                <!-- how to create a .tgz file: -->
                                <!--
                                <tar destfile="${project.build.directory}/${project.artifactId}-${project.version}.tgz" compression="gzip">
                                    <fileset dir="${project.build.directory}/application" />
                                </tar>
                                -->
                            </target>
                        </configuration>
                    </execution>
                </executions>
                <dependencies>
                    <dependency>
                        <groupId>org.apache.ant</groupId>
                        <artifactId>ant</artifactId>
                        <version>1.9.15</version>
                    </dependency>
                    <dependency>
                        <groupId>ant-contrib</groupId>
                        <artifactId>ant-contrib</artifactId>
                        <version>1.0b3</version>
                    </dependency>
                </dependencies>
            </plugin>	    
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>build-helper-maven-plugin</artifactId>
                <executions>                      
                    <execution>
                        <id>attach-artifacts</id>
                        <phase>package</phase>
                        <goals>
                            <goal>attach-artifact</goal>
                        </goals>
                        <configuration>
                            <artifacts>
                                <artifact>
                                    <file>${project.build.directory}/${project.artifactId}-${project.version}.zip</file>
                                    <type>zip</type>
                                </artifact>
                                <!-- how to create a .tgz file: -->
                                <!--
                                <artifact>
                                    <file>${project.build.directory}/${project.artifactId}-${project.version}.tgz</file>
                                    <type>tgz</type>
                                </artifact>
                                -->
                            </artifacts>
                        </configuration>
                    </execution>
                </executions>
            </plugin>

					
        </plugins>
        		
    </build>
	

</project>
