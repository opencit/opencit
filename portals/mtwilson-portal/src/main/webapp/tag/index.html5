
<!DOCTYPE html>



<html lang="en">

    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title data-i18n="title.asset_tag">Asset Tag Management</title>
        <meta name="application-name" content="Mt Wilson Asset Tag Management"/>
        <meta name="description" content="A web-based tool for defining tags and provisioning asset certificates" />
        <meta name="keywords" content="Mt Wilson, attestation, asset, inventory, management, security, cloud, data center" />
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />

        <link rel="resources" type="application/vnd.mtwilson.resource+json" href="/resources.json">
        
        <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
        
        
        <!-- Add mtwilson libraries -->
        <!--link rel="stylesheet" href="images/at.css" type="text/css" /-->
        <link rel="stylesheet" type="text/css" href="CSS/home.css" />
        <link rel="stylesheet" type="text/css" href="CSS/JQueryHelperCSS/jquery.ui.menubar.css" />
        <link rel="stylesheet" type="text/css" href="CSS/JQueryHelperCSS/style.css" />
        <link href="CSS/JQueryHelperCSS/multi-select.css" media="screen" rel="stylesheet" type="text/css">
        
        <!-- Workaround for IE8 issue: Console object does not exist and hence console.log errors out with an exception -->
        <script type="text/javascript">
            var console=console||{"log":function(){}};
        </script>
        <link rel="stylesheet" type="text/css" href="CSS/bootstrap.css" />
        <link rel="stylesheet" type="text/css" href="CSS/dashboard.css" />
        <link rel="stylesheet" type="text/css" href="CSS/intel.css" />
        <script type="text/javascript" src="Scripts/bootstrap.min.js"></script>
        <script type="text/javascript" src="JQuery/jquery-1.7.2.js"></script>
        <script type="text/javascript" src="JQuery/jquery.json-1.3.min.js"></script>
        <script type="text/javascript" src="JQuery/jquery.ui.core.js"></script>
        <script type="text/javascript" src="JQuery/jquery.ui.dialog.js"></script>
        <script type="text/javascript" src="JQuery/jquery.effects.core.js"></script>
        <script type="text/javascript" src="JQuery/jquery.ui.widget.js"></script>
        <script type="text/javascript" src="JQuery/jquery.ui.position.js"></script>
        <script type="text/javascript" src="JQuery/jquery.ui.menu.js"></script>
        <script type="text/javascript" src="JQuery/jquery.ui.menubar.js"></script>
        <script type="text/javascript" src="JQuery/jquery.paginate.js"></script>
        <script type="text/javascript" src="Scripts/ajaxfileupload.js"></script>
        <script type="text/javascript" src="JQuery/jquery.popupWindow.js"></script>
        <script src="JQuery/jquery.multi-select.js" type="text/javascript"></script>
          
     
        <script src="watch.js" type="text/javascript"></script> <!-- required to use rivets -->
        <script src="prototype-1.7.2.js" type="text/javascript"></script> <!-- required by log.js -->
        
        
        <!-- ui tools -->
        <script src="scriptaculous-1.9.0/scriptaculous.js" type="text/javascript"></script> 
        <script src="livepipe/livepipe.js" type="text/javascript"></script>
        <script src="livepipe/contextmenu.js" type="text/javascript"></script>
        <script src="livepipe/cookie.js" type="text/javascript"></script>
        <script src="livepipe/event_behavior.js" type="text/javascript"></script>
        <script src="livepipe/hotkey.js" type="text/javascript"></script>
        <script src="livepipe/progressbar.js" type="text/javascript"></script>
        <script src="livepipe/rating.js" type="text/javascript"></script>
        <script src="livepipe/resizable.js" type="text/javascript"></script>
        <script src="livepipe/scrollbar.js" type="text/javascript"></script>
        <script src="livepipe/selection.js" type="text/javascript"></script>
        <script src="livepipe/selectmultiple.js" type="text/javascript"></script>
        <script src="livepipe/tabs.js" type="text/javascript"></script>
        <script src="livepipe/textarea.js" type="text/javascript"></script>
        <script src="livepipe/window.js" type="text/javascript"></script>
        <script src="URI.js" type="text/javascript"></script>
        <script src="validation.js" type="text/javascript"></script>
        <script src="input.js" type="text/javascript"></script>
        <script src="array.js" type="text/javascript"></script>
        <script src="merge.js" type="text/javascript"></script>
        <script src="date.js" type="text/javascript"></script> <!-- required by log.js -->
        <script src="log.js" type="text/javascript"></script> <!-- requires prototype.js, date.js -->
        <script src="form.js" type="text/javascript"></script>
        <script src="rivets.js" type="text/javascript"></script>
        <script src="findx.js" type="text/javascript"></script>
        <script src="rivets-adapter-watch-findx.js" type="text/javascript"></script> <!-- requires rivets, watch.js, and findx -->

        <script src="base64.js" type="text/javascript"></script>
        <script src="ajax.js" type="text/javascript"></script>
         <script src="token.js" type="text/javascript"></script>
         <script src="atclient.js" type="text/javascript"></script>
        
        <script type="text/javascript" src="Scripts/commonUtils.js"></script>
        <script type="text/javascript" src="../Scripts/safe.js"></script>
        <script type="text/javascript" src="Scripts/CommonMessage.js"></script>
        <script type="text/javascript" src="Scripts/home.js"></script>
        <script type="text/javascript" src="i18next-1.7.1.min.js"></script>
        <script type="text/javascript" src="i18n_util_jquery.js"></script>

        <script type="text/javascript">
            var ws = mtwilson.atag; // local name for the asset tag web service
        </script>

        <script type="text/javascript">
// credit for isNumber (creative commons share alike 3.0) http://stackoverflow.com/questions/18082/validate-numbers-in-javascript-isnumeric/1830844#1830844
function isNumber(n) {
  return !isNaN(parseFloat(n)) && isFinite(n);
}            
            
            // watch adapter, from https://github.com/mikeric/rivets/wiki/Adapters
            rivets.configure({
                adapter: rivets_watch_findx_adapter,
                prefix: 'bind' // so data binding happens for data-bind-whatever attributes (instead of data-whatever) ; which allows us to use input.js because it uses data-alt.
                /*
                binders: {
                    'alt': function(el,value) { } // do nothing; this allows input.js to continue using data-alt for its default display text. another way to do it would be to use the 'prefix' configuration of rivets like  prefix:'bind' and then use data-bind-whatever instead of just data-whatever in the forms.
                }
                 */
            });
            
            // input like timestamp 1377839054000 or text date format like yyyy-MM-dd, output like:  2013-08-30T05:04:14.000Z
                rivets.formatters.isodate = function(value) {
                        if( isNumber(value) ) {
                            return new Date(value).toISOString();
                        }
                        else {
                            return Date.parse(value).toISOString();
                        }
                    };
                rivets.formatters.date = function(value) {
                    var date;
                    if( isNumber(value) ) {
                        date = new Date(value).toString();
                    }
                    else {
                        date = Date.parse(value).toString();
                    }
                    return date.toISOString()
                };
                rivets.formatters.translate = function(value) {
                    var key = "label." + value.toLowerCase();
                    return i18n.t(key);
                };
                    // input any value that evaluates to true/false, output either "yes" or "no" or replace those with your own "yes value" and "no value" for example "Active" and "Inactive" instead of "yes" and "no"
               rivets.formatters.yesno = function(value,yestext,notext) {
                   if( value ) {
                       return yestext ? yestext : "yes";
                   }
                   else {
                       return notext ? notext : "no";
                   }
               };
               // input any hex or base64 value and this will return the value with newlines inserted
               rivets.formatters.wrap = function(text,columns,sep) {
                   var i=0, result="";
                   columns = columns ? parseInt(columns) : 20;
                   sep = sep || " ";
                   log.debug("wrap text: "+text+"  length: "+text.length+"  columns: "+columns);
                   while(i<text.length) { result += text.slice(i,i+columns) + sep; i += columns; }
                   log.debug("wrap result: "+Object.toJSON(result));
                   return result;
               };

                rivets.formatters.escapeAttribute = function(value) {
                        return escapeForHTMLAttributes(value);
                };

               
//                }


            
        </script>
        

    </head>
    
    <body style="background: #ffffff">
        
            <style>
                li
                {
                display:inline;
                }
            </style>
 

            <!--header -->
            <div id="innerHeader_mtw" class="header" style="display: none;">
                <div class="title"><h1>Mt. Wilson</h1></div>
                
                <div class="clear hideSkiplink">
                    <div id="NavigationMenu" class="menu" style="float: left;">
                        <!--ul id="menubarItems" style="display: inline;">
                             <li>
                                <a>Asset Tag Management</a>
                                <ul id="navtabs">
                                    <li><a href="#tags">Tag Creation</a></li> 
                                    <li><a href="#selections">Tag Selection</a></li>
                                    <li><a href="#certificates">Certificate Management</a></li>
                                    <!--<li><a href="#configure">Settings</a></li>-->
                                    <li><a href="#log">Log</a></li>

                                </ul>
                            </li>
                        </ul-->
                        
                        <nav id="nav">
                            <ul id="navtabs"> 
                                <li ><a href="#tags">Tag Creation</a></li>  
                                <li ><a href="#selections">Tag Selection</a></li>
                                <li ><a href="#certificates">Certificate Management</a></li>			
                                <li ><a href="#provisionTag">Provision Tag</a></li>			
                                <!--<li ><a href="#configure">Settings</a></li>-->
                                <li ><a href="#log">Log</a></li>
                            </ul>
                        </nav>		

                    </div>
                    <div style="clear: left;"></div><a id="NavigationMenu_SkipLink"></a>
                </div>
            </div>
            				
            <div id="notifications_container" style="clear: both; width: 840px; height: 20px; max-height: 50px;  margin-top: 0px;">
            </div>
           
            <div class="main" id="mainContainer">
                <!-- content-wrap starts -->
                <!--div id="content-wrap" class="one-col"  -->	
                <div class="container" id="tagsMainContainer">

                    <div id="main">

                        <div id="tags">
                            <script>

                                function tag_create_form_addValue() {
                                    mtwilson.rivets.forms['tag-create-form'].input.mergeInsert({value:""}); // sets the values to empty string if it's not already defined (applies first time this function is called)
                                    var value = (""+$F('tag-create-values')).strip();
                                    //if( value.empty() || !verify_for_value_duplicates(value)) { return; }
                                    //        alert("add value: "+value);
                                    log.debug("uh? "+Object.toJSON(mtwilson.rivets.forms['tag-create-form']));
                                    //mtwilson.rivets.forms['tag-create-form'].input.values.push($F('tag-create-values')); 
                                    mtwilson.rivets.forms['tag-create-form'].input.value = $F('tag-create-values'); 
                                    $('tag-create-values').focus(); 
                                    //$('tag-create-values').clear();
                                    //$('tag-create-name').disable();
                                }
			
				// Verifies if the Tag values are duplicate for the new tag that is being created.
				function verify_for_value_duplicates(new_val) {
					var existing_vals = mtwilson.rivets.forms['tag-create-form'].input.values; 

					for(var i = 0; i < existing_vals.length; i++) {
						if(existing_vals[i].toLowerCase() == new_val.toLowerCase()) {
							return false;
						}
					}
					return true;
				}

                function tag_create_form_removeValue(tagValue) {
//                    mtwilson.rivets.forms['tag-create-form'].input.values.removeAll(tagValue); 
                    mtwilson.rivets.views['tag-create-form'].sync(); 
//				      if(mtwilson.rivets.forms['tag-create-form'].input.values.length== 0) {
                        $('tag-create-name').enable();
                        $('tag-create-name').focus(); 
                        $('tag-create-name').clear();
//                    }
                }

				// called when submitting the form... checks that at least one value was added
                function tag_create_form_validateValues() {
                    return mtwilson.rivets.forms['tag-create-form'].input.values.length > 0;
                }

				function tag_create_edit_tag(id, name, value) {
                    $('tag-create-values').focus(); 
                    $('tag-create-name').disable(); 
                    $('tag-create-id').value = id;
                    $('tag-create-name').value = name;
                    $('tag-create-values').value = value;
                }
                            </script>
                            
                            <div class="nagPanel"><span data-i18n="title.tag_management">Asset Tag Management</span> &gt;</div>
                            <div id="nameOfPage" class="NameHeader" data-i18n="header.tag_creation">Create New Tag</div> 
                            
                            <form id="tag-create-form">

                                    <div class="singleDiv">
                                    <div class="labelDiv" data-i18n="input.tag_name">Tag Name:</div>
                                    <div class="valueDiv">
                                        <input type="text" class="textBox_Border" id="tag-create-name" data-bind-value="input.name" data-i18n="[placeholder]label.tag_name">
                                        <span class="requiredField">*</span>
                                    </div>
                                    </div>

                                    <div class="singleDiv tagOIDDiv">
                                    <div class="labelDiv" data-i18n="input.tag_oid">Tag OID (optional):</div>    
                                    <div class="valueDiv">
                                        <input type="text" class="textBox_Border" id="tag-create-oid" data-bind-value="input.id" data-i18n="[placeholder]label.tag_oid">
                                    </div>
                                    </div>


                                    <div class="singleDiv" style="height: 66px;">
                                        <div class="labelDiv" data-i18n="input.tag_value">Tag Value:</div>
                                        <div class="valueDiv">
                                            <input type="text" class="textBox_Border" id="tag-create-values" data-i18n="[placeholder]label.tag_value" data-validator="tag_create_form_validateValues">
                                        </div>
                                        <div class="valueDiv">
                                            <!--input type="button" class="uploadButton" value="Add" onclick="tag_create_form_addValue();"-->
                                            <input type="button" class="uploadButton" value="Save" data-i18n="[value]button.save" onclick="tag_create_form_addValue(); ws.createTag(this); return false;">
                                            <input type="text" class="textBox_Border" id="tag-create-id" data-bind-value="input.id" data-i18n="[placeholder]label.tag_oid" size="1" style="display:none">
                                            <span style="display: none;" class="validation-advice" id="advice-tag-create-values" data-i18n="label.one_value_required">You must add at least one value.</span>
                                            <ul style="max-width: 600px; margin-left: 0px; padding-left: 0px; list-style: none;">
                                                <li style="display: inline-block; border: 1px solid black; border-radius: 3px; padding-left: 5px; padding-right: 5px; margin: 3px;" data-bind-each-item="input.values"><span data-bind-text="item"></span> <a data-bind-tagValue="item" href="#" style="color: red; font-weight: bold;" onclick="javascript:tag_create_form_removeValue(this.getAttribute('tagValue'));">X</a></li>
                                            </ul>


                                        </div>
                                    </div> 


                            </form>

                            <!--div id="nameOfPage" class="NameHeader">Search Tags</div>
                            <div class="singleDiv" style="height: 45px;"></div-->
                            <div id="nameOfPage" class="NameHeader"><span data-i18n="header.tag_browse">Browse Tags</span>&nbsp;&nbsp; 
                                <a href="javascript:toggleElementVisibility('tag-search-form')" style='font-size: 0.8em'>(<span data-i18n="link.search">Search</span>)</a>
                            </div>

                            <form id="tag-search-form" action="#" onsubmit="return false;" style="display: none">
                                    <div class="singleDiv">
                                        <div class="labelDiv" data-i18n="input.tag_name">Tag Name:</div> <!-- was: "Host Provided By" -->
                                        <div class="valueDiv">
                                            <select class="ddlBox_small_Border" id="tag-search-name-criteria">
                                                <option value="EqualTo" data-i18n="select.is">is</option>
                                                <option value="Contains" data-i18n="select.contains">contains</option>
                                            </select>
                                            <input type="text" class="textBox_special_small" id="tag-search-name" name="name" data-i18n="[placeholder]label.tag_name">
                                        </div>
                                    </div>

                                    <div class="singleDiv tagOIDDiv">
                                        <div class="labelDiv" data-i18n="input.tag_oid">Tag OID:</div> <!-- was: "Host Provided By" -->
                                        <div class="valueDiv">
                                            <select class="ddlBox_small_Border" id="tag-search-oid-criteria">
                                                <option value="EqualTo" data-i18n="select.is">is</option>
                                                <option value="Contains" data-i18n="select.contains">contains</option>
                                            </select>
                                            <input type="text"  class="textBox_special_small" id="tag-search-oid" name="oid" data-i18n="[placeholder]label.tag_oid">
                                        </div>
                                    </div>

                                    <div class="singleDiv">
                                        <div class="labelDiv" data-i18n="input.tag_value">Tag Value:</div> 
                                        <div class="valueDiv">
                                            <select class="ddlBox_small_Border" id="tag-search-value-criteria">
                                                <option value="EqualTo" data-i18n="select.is">is</option>
                                                <option value="Contains" data-i18n="select.contains">contains</option>
                                            </select>
                                            <input type="text"  class="textBox_special_small" id="tag-search-value" name="value" data-i18n="[placeholder]label.tag_value">
                                        </div>
                                    </div>

                                    <input type="submit" class="uploadButton" value="Search" data-i18n="[value]button.search" onclick="ws.searchTags(this); return false;">
					&nbsp;&nbsp;
                                    <input type="button" class="uploadButton" value="Cancel" data-i18n="[value]button.cancel" onclick="$('tag-search-form').reset();toggleElementVisibility('tag-search-form'); ws.searchTags(this); return false;">

                            </form>

                            <div class="singleDiv" style="height: 8px;"></div>


                            <div>
                                <table class="tableDisplayBind" style="width: 800px;" cellpadding=0 cellspacing=0>
                                    <thead>
                                        <tr>
                                            <th class="col_tag_names" data-i18n="label.tag_name">Tag Name</th>
                                            <th class="row9 tagOIDDiv" data-i18n="label.tag_oid">Tag OID</th>
                                            <th class="row_tag_values" data-i18n="label.tag_value">Tag Value</th>
                                            <th class="col_del_link" style='border-right: 1px solid #3A4F63' ></th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                            <div style="overflow-x: hidden; overflow-y: auto; width: 800px; max-height: 590px;">
                            <!-- <div  class="tableDisplayScroll_small"> -->
                            <table id="tag-browse-table" class="tableDisplayBind" style="width: 800px;" cellpadding=0 cellspacing=0>
                                <tbody>
                                    <tr class="evenRow" data-bind-each-item="tags">
                                        <td align="center" class="col_tag_names" data-bind-text="item.name | escapeAttribute"></td>
                                        <td align="center" class="row2 tagOIDDiv" data-bind-text="item.oid | escapeAttribute"></td>
                                        <td align="center" class="col_auto" style="max-width: 400px; padding: 5px;">
                                            <ul style="margin-left: 0px; padding-left: 0px; list-style: none; display: inline;">
                                                <li style="border: none; " data-bind-each-item="item.value"><span data-bind-text="item | escapeAttribute"></span></li>
                                            </ul>
                                        </td>
                                        <td align="center" class="col_del_link">
                                            <a data-bind-oid="item.oid" data-bind-id="item.id" data-bind-name="item.name" data-bind-tagValue="item.value" href="#" onclick="javascript:tag_create_edit_tag(this.getAttribute('id'), this.getAttribute('name'), this.getAttribute('tagValue')); return false;" data-toggle="tooltip" title="Edit Tag"><span class="glyphicon glyphicon-edit"></span></a>
                                            <a data-bind-oid="item.oid" data-bind-id="item.id"  href="#" onclick="javascript:ws.removeTag(this.getAttribute('id')); return false;" data-toggle="tooltip" title="Delete Tag"><span class="glyphicon glyphicon-trash"></span></a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            </div>


                            <!-- end tags tab  -->
                        </div>

                        <div id="selections" >
                            <div class="nagPanel"><span data-i18n="title.tag_selection_management">Tag Selection</span> &gt;</div>
                            <div id="nameOfPage" class="NameHeader" data-i18n="header.selection_creation">Create New Selection</div> 

                            <script>
                                function selection_create_form_init() {
                                    log.debug("selection_create_form_init: rivets forms: "+Object.toJSON(mtwilson.rivets.forms['selection-create-form'].input));
    //                                if( mtwilson.rivets.forms['selection-create-form'] ) {
                                        log.debug("selection_create_form_init: got selection-create-form");
                                        log.debug("selection_create_form_init: current tag data is: "+Object.toJSON(mtwilson.atag.data.tags));
                                        mtwilson.rivets.forms['selection-create-form'].input.name = ''; 
                                        mtwilson.rivets.forms['selection-create-form'].tagValues = [];
    //                                    mtwilson.rivets.forms['selection-create-form'].tags = mtwilson.atag.data.tags; // already part of global binding
                                        mtwilson.rivets.forms['selection-create-form'].input.selection = [];
                                        // and initialize the second select box with values of the first tag
                                        log.debug("current value: "+getSelectOptionValue('selection-create-tags-select')); // too early... ui update didn't happen yet
                                        selection_create_form_onSelectTag( getSelectOptionValue('selection-create-tags-select') );
    //                                }                                
                                }
                                function selection_create_form_onSelectTag(tagName) {
                                    var tagNamesList = document.getElementById('selection-create-tags-select');
                                    if(tagNamesList.selectedIndex <= 0 ) { return; }
                                    tagName = tagNamesList.options[tagNamesList.selectedIndex].value;
                                    if(tagName == '') { return; }
                                    var tag = ws.findTagByName(tagName);
//                                    log.debug("selection_create_form_onSelectTag: selected tag id: "+tagId);
//                                    var tag = ws.findTagByOid(tagId);
//                                    var tag = ws.findTagByUuid(tagId);
                                    log.debug("selection_create_form_onSelectTag: found tag: "+Object.toJSON(tag));
//                                    log.debug("selection_create_form_onSelectTag: rivets forms: "+Object.toJSON(mtwilson.rivets.forms['selection-create-form']));
                                    mtwilson.rivets.forms['selection-create-form'].tagValues.clear().merge(tag.tagValues); 
                                }

                function selection_create_form_addValue() {
				    if($("selection-create-name").value.trim() == "") {
					    return false;
				    }
                    var tag_obj = {};
                    var tagName = $F('selection-create-tags-select');
				    tag_obj.name = $F('selection-create-tags-select');
                    tag_obj.id = $F('selection-create-tags-values');
                    var tagValue = getSelectOptionText('selection-create-tags-values');
				    if(tagValue == "") { return; }
                    tag_obj.value = tagValue;
				    if(!verify_selections_for_duplicates(tag_obj, tagValue)) {
					    return false;
				    }
				    $('tableDisplayScroll_small').show();
					    mtwilson.rivets.forms['selection-create-form'].input.selection.push({ tag:tag_obj, value: tagValue});  
//                        log.debug("added tag ("+tag.oid+","+tagValue+") to selection: "+Object.toJSON(mtwilson.rivets.forms['selection-create-form'].input.selection));
                }

				function verify_selections_for_duplicates(tag, val) {
					var sel_elements = mtwilson.rivets.forms['selection-create-form'].input.selection;
					for(var i = 0 ; i < sel_elements.length; i++) {
						if (sel_elements[i].tag.name == tag.name && sel_elements[i].value == val) {
							return false;
						}
					}
					return true;
				}

                                function selection_create_form_removeValue(tagOid,tagValue) {
                                    var i = mtwilson.rivets.forms['selection-create-form'].input.selection.length;
                                    log.debug("looking through "+i+" selections for value to remove: ("+tagOid+","+tagValue+")");
                                    while(i--) {
                                        if( mtwilson.rivets.forms['selection-create-form'].input.selection[i].tag.oid == tagOid &&  mtwilson.rivets.forms['selection-create-form'].input.selection[i].value == tagValue ) {
                                            mtwilson.rivets.forms['selection-create-form'].input.selection.splice(i,1);
                                        }
                                    }
                                    log.debug("removed tag ("+tagOid+","+tagValue+") from selection: "+Object.toJSON(mtwilson.rivets.forms['selection-create-form'].input.selection));
                                    mtwilson.rivets.views['selection-create-form'].sync(); 
				    if(mtwilson.rivets.forms['selection-create-form'].input.selection.length == 0) {
				    	$('tableDisplayScroll_small').hide();
				        $('selection-create-name').enable();
                        $('selection-create-name').clear();
                        $('selection-create-desc').clear();
				    }

                                }

				function selection_create_form_removeAllValues() {
                    var i = mtwilson.rivets.forms['selection-create-form'].input.selection.length;
                    while(i--) {
                        mtwilson.rivets.forms['selection-create-form'].input.selection.splice(i,1);
                    }
                    $('tableDisplayScroll_small').hide();
                    $('selection-create-name').enable();
                    $('selection-create-name').clear();
                    $('selection-create-desc').clear();
				}

                                // called when submitting the form... checks that at least one value was added
                                function selection_create_form_validateValues() {
                                    return mtwilson.rivets.forms['selection-create-form'].input.selection.length > 0;
                                }

                            </script>
                            <!--div class="singleDiv"-->
                            <form id="selection-create-form" action="#" onsubmit="return false;">

                                <div class="singleDiv">
                                    <div class="labelDiv" data-i18n="input.name">Name:</div>
                                    <div class="valueDiv">
                                        <input type="text" class="textBox_Border" id="selection-create-name" name="name" data-bind-value="input.name" data-i18n="[placeholder]placeholder.selection_name">
                                        <span class="requiredField">*</span>
                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv" data-i18n="input.description">Description:</div>
                                    <div class="valueDiv">
                                        <input type="text" class="textBox_Border" id="selection-create-desc" name="desc" data-bind-value="input.desc" data-i18n="[placeholder]placeholder.selection_description">
                                    </div>
                                </div>
								
                                <div class="singleDiv">
                                    <div class="labelDiv" data-i18n="input.tags">Tags:</div> <!-- was: "Host Provided By" -->
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="selection-create-tags-select" onchange="selection_create_form_onSelectTag(getSelectOptionValue(this.id));">
                                            <option data-bind-each-item="global.rearranged_tags" data-bind-value="item.name | escapeAttribute" data-bind-id="item.name | escapeAttribute" data-bind-text="item.text | escapeAttribute"></option>
                                        </select>
                                        <select class="ddlBox_small_Border" id="selection-create-tags-values" data-validator="selection_create_form_validateValues">
                                            <option data-bind-each-item="tagValues" data-bind-value="item.id | escapeAttribute" data-bind-text="item.value | escapeAttribute"></option>
                                        </select>

                                        <input type="button" class="uploadButton" value="Add" id="selection-create-tags-select-add" data-i18n="[value]button.add" onclick="selection_create_form_addValue(); return false;"/>
                                    </div>
                                </div>

                                <div class="singleDiv" style="height: 10px;"></div>

                                <div id="tableDisplayScroll_small" style="display: none;">
                                    <div>
                                        <table class="tableDisplay" style="width: 800px;" cellspacing=0 cellpadding=0>
                                            <thead>
                                                <tr>
                                                    <th class="col_tag_names">Tag name</th>
                                                    <th class="col_auto">Tag Value</th>
                                                    <th class="col_auto">Tag ID</th>
                                                    <th class="col_del_link"></th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                    <div style="overflow-x: hidden; overflow-y: auto; width: 800px; max-height: 185px;">
                                    <!-- <div id="tableDisplayScroll_small" style="display: none" class="tableDisplayScroll_small" -->
                                        <table id="selection-create-tags-table" class="tableDisplay" style="width: 800px;" cellspacing=0 cellpadding=0>
                                            <tbody>
                                                <tr class="evenRow" data-bind-each-item="input.selection">
                                                    <td align="center" class="col_tag_names" data-bind-text="item.tag.name | escapeAttribute"></td>
                                                    <td align="center" class="col_auto" data-bind-text="item.value | escapeAttribute"></td>
                                                    <td align="center" class="col_auto" data-bind-text="item.tag.id | escapeAttribute"></td>
                                                    <td align="center" style='border-right: 1px solid #3A4F63' class="col_del_link"> <a data-bind-tagOid="item.tag.oid" data-bind-tagValue="item.value" href="#" onclick="javascript:selection_create_form_removeValue(this.getAttribute('tagOid'),this.getAttribute('tagValue'));">remove</a></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <input type="submit" value="Save" onclick="ws.createSelection(this); return false;"/>
                                </div>
                                <div id="table_view_sel_details" class="tableDisplayScroll_small" style="display: none; height: auto !important">
                                    <div class="singleDiv" style="height: 10px;"></div>                                

									<table id="selection-edit-tags-table" class="tableDisplay" style="width: 800px; display: block" cellspacing=0 cellpadding=0>
                                        <thead style="width: 100%">
                                            <tr>
                                                <th class="col_tag_names" style="width: 200px; border-right: 1px solid #3A4F63">Tag name</th>
                                                <th class="col_auto" style="width: 200px">Tag Value</th>
                                                <th class="col_auto tagOIDDiv" style="width: 400px">Tag ID</th>
                                            </tr>
                                        </thead>
                               
                                        <tbody style="width: 100%">
                                            <tr class="evenRow" data-bind-each-item="global.selection_details">
                                                <td align="center" class="col_tag_names" data-bind-text="item.kv_attribute_name | escapeAttribute"></td>
                                                <td align="center" class="col_auto" data-bind-text="item.kv_attribute_value | escapeAttribute" style='border-right: 1px solid #3A4F63'></td>
                                                <td align="center" class="col_auto tagOIDDiv" data-bind-text="item.id | escapeAttribute"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <input type="submit" value="Cancel" onclick="toggleElementVisibility('table_view_sel_details');showSelectionInputValues();return false;"/>
                                    </div>

                            </form>

                            <div class="singleDiv" style="height: 10px;"></div>
                            <!--div id="nameOfPage" class="NameHeader">Search Selections</div--> 
                            <!--h2>Search Selections</h2-->


                            <div id="nameOfPage" class="NameHeader"><span data-i18n="header.selection_browse">Browse Selections</span>&nbsp;&nbsp; 
                                <a href="javascript:toggleElementVisibility('selection-search-form')" style='font-size: 0.8em'>(<span data-i18n="link.search">Search</span>)</a></div> 
                            <!--h2>Browse Selections</h2-->

                            <form id="selection-search-form" action="#" onsubmit="return false;" style='display: none'>

                                <div class="singleDiv">
                                    <div class="labelDiv" data-i18n="input.name">Name:</div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="selection-search-name-criteria">
                                            <option value="EqualTo" data-i18n="select.is">is</option>
                                            <option value="Contains" data-i18n="select.contains">contains</option>
                                        </select>

                                        <input type="text" class="textBox_special_small" id="selection-search-name" name="name" data-i18n="[placeholder]label.name"/>
                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv" data-i18n="input.tag_name">Tag Name:</div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="selection-search-tagName-criteria">
                                            <option value="EqualTo" data-i18n="select.is">is</option>
                                            <option value="Contains" data-i18n="select.contains">contains</option>
                                        </select>

                                        <input type="text" class="textBox_special_small" id="selection-search-tagName" name="tagName" data-i18n="[placeholder]label.tag_name"/>
                                    </div>
                                </div>

                                <div class="singleDiv tagOIDDiv">
                                    <div class="labelDiv" data-i18n="input.tag_oid">Tag OID:</div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="selection-search-tagOid-criteria">
                                            <option value="EqualTo" data-i18n="select.is">is</option>
                                            <option value="Contains" data-i18n="select.contains">contains</option>
                                        </select>

                                        <input type="text" class="textBox_special_small" id="selection-search-tagOid" name="tagOid" data-i18n="[placeholder]label.tag_oid"/>
                                    </div>
                                </div>

                                 <div class="singleDiv">
                                    <div class="labelDiv" data-i18n="input.tag_value">Tag Value:</div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="selection-search-tagValue-criteria">
                                            <option value="EqualTo" data-i18n="select.is">is</option>
                                            <option value="Contains" data-i18n="select.contains">contains</option>
                                        </select>
                                        
                                        <input type="text" class="textBox_special_small" id="selection-search-tagValue" name="tagValue" data-i18n="[placeholder]label.tag_value"/>
                                    </div>
                                </div>

                                <input type="submit" class="uploadButton" value="Search" data-i18n="[value]button.search" onclick="$('table_view_sel_details').hide();ws.searchSelections(this); return false;"/>
                                <input type="button" class="uploadButton" value="Cancel" data-i18n="[value]button.cancel" onclick="$('selection-search-form').reset(); toggleElementVisibility('selection-search-form');$('table_view_sel_details').hide();ws.searchSelections(this); return false;"/>

	                            <div class="singleDiv" style="height: 10px;"></div>
                            </form>

                            <div class="singleDiv" style="height: 10px;"></div>
                            <div>
                                <table class="tableDisplayBind" style="width: 800px;" cellspacing=0 cellpadding=0>
                                    <thead>
                                        <tr>
                                            <th class="col_tag_names" data-i18n="label.selection_name">Selection Name</th>
                                            <th class="col_auto" style="width: 175px;" data-i18n="label.description">Description</th>
                                            <th class="col_del_link"></th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                            <div style="clear:both; overflow-x: hidden; overflow-y: auto; width: 800px; max-height: 280px;">
                            <!--<div class="tableDisplayScroll_small" style="clear:both">-->
                            <table id="selection-browse-table" class="tableDisplayBind" style="width: 800px;" cellspacing=0 cellpadding=0>
                            <!--table id="selection-browse-table" class="dataview"-->
                                <tbody>
                                    <tr class="evenRow" data-bind-each-item="selections">
                                        <td align="center" class="col_tag_names" data-bind-text="item.name | escapeAttribute"></td>
                                        <td align="center" class="col_auto" style="width: 175px;" data-bind-text="item.description | escapeAttribute"></td>
                                        <!--td align="center" class="col_auto">
                                            <table cellspacing=0 cellpadding=0>
                                                <thead>
                                                    <tr>
                                                        <th class="col_auto">Name</th>
                                                        <th class="col_auto">Value</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="evenRow" data-bind-each-item="item.tags">
                                                        <td align="center" class="col_auto col_tag_names" data-bind-text="item.name | escapeAttribute"></td>
                                                        <td align="center" class="last_col col_auto" data-bind-text="item.description | escapeAttribute"></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </td-->
<script type='text/javascript'>
	function getSelDetails(uuid, name, desc) {
		$('selection-create-name').disable();
		$('selection-create-desc').disable();
 		mtwilson.rivets.forms['selection-create-form'].input.name = name;
 		mtwilson.rivets.forms['selection-create-form'].input.desc = desc;
                disable_sel_render = true;
		ws.getSelectionDetails(uuid);
	}

	function showSelectionInputValues() {
		$('selection-create-name').enable();
		$('selection-create-desc').enable();
		$('selection-create-name').value = "";
		$('selection-create-desc').value = "";
 		mtwilson.rivets.forms['selection-create-form'].input.name = "";
 		mtwilson.rivets.forms['selection-create-form'].input.desc = "";
	}
</script>
										
                                        <td align="center" class="col_del_link">
                                            <a data-bind-uuid="item.id" data-bind-name="item.name" data-bind-desc="item.description" href="#" data-i18n="link.view_tags" onclick="javascript:getSelDetails(this.getAttribute('uuid'), this.getAttribute('name'), this.getAttribute('desc')); return false;">View Tags</a>&nbsp;&nbsp;
                                            <a data-bind-uuid="item.id" href="#" data-i18n="link.delete" onclick="javascript:ws.removeSelection(this.getAttribute('uuid')); return false;">Delete</a><br />
                                            <span data-i18n="label.export_xml">Export XML</span>(<a data-bind-uuid="item.id" href="#" data-i18n="link.plain" onclick="javascript:ws.exportXmlSelection(this.getAttribute('uuid'), 'xml'); return false;">Plain</a>,&nbsp;<a data-bind-uuid="item.id" href="#" data-i18n="link.encrypted" onclick="javascript:ws.exportXmlSelection(this.getAttribute('uuid'), 'enc'); return false;">Encrypted</a>)
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            </div>

                            <!--/div-->

                            <!-- end selections tab -->
                        </div>

                        <div id="certificates">
                            <div class="nagPanel"><span data-i18n="title.tag_certificate_management">Manage Certificates</span> &gt;</div>
                            <div id="nameOfPage" class="NameHeader" data-i18n="header.certificate_creation">Create New Certificate</div> 
                           
                            <form id="certificate-request-create-form" action="#" onsubmit="return false;">
                                 <div class="singleDiv">
                                    
                                    <div class="labelDiv" data-i18n="input.hostname">Host Name:</div>
                                    <div class="valueDiv">
                                        <input type="text" id="uuid-populate-host" name="uuidHost" size="40" data-i18n="[placeholder]placeholder.hostname"/>
                                        <!--input type="button" value="Populate Subject Box" onclick="ws.autoPopulateUUID(this); return false;"/--> 
                                    </div>
                                </div>
                                <!--div class="singleDiv">
                                    
                                    <div class="labelDiv">Subject : </div>
                                    <div class="valueDiv">
                                        <input type="text" class="textBox_Border" id="certificate-request-create-subject" name="subject" data-bind-value="input.subject" placeholder="Host UUID">
                                        <span class="requiredField">*</span>
                                    </div>
                                </div-->

                                <div class="singleDiv">
                                    <div class="labelDiv" data-i18n="input.tag_selection">Tag Selection: </div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="certificate-request-create-tag-selection" data-bind-value="input.selection"> <!-- this is required -->
                                            <option data-bind-each-item="global.unfiltered_sels" data-bind-value="item.id" data-bind-text="item.name"></option>
                                        </select>

                                        <input type="submit" class="uploadButton" value="Save" data-i18n="[value]button.save" onclick="ws.createCertificateRequest(this); return false;"/>
                                    </div>
                                </div>

                            </form>

                            <div class="singleDiv" style="height: 25px;"></div>
                            <div style="display: none;">
                            <div id="nameOfPage" class="NameHeader">Search Certificate Requests</div> 

                            <form id="certificate-request-search-form" action="#" onsubmit="return false;">


                                <div class="singleDiv">
                                    <div class="labelDiv">Subject: </div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="certificate-request-search-subject-criteria"> 
                                            <option value="EqualTo" data-i18n="select.is">is</option>
                                        </select>

                                        <input type="text" class="textBox_special_small" id="certificate-request-search-subject" name="subject" placeholder="Host UUID"/>

                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv">Selection: </div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="certificate-request-search-selection-criteria"> 
                                            <option value="EqualTo" data-i18n="select.is">is</option>
                                        </select>

                                        <input type="text" class="textBox_special_small" id="certificate-request-search-selection" name="selection" placeholder="Selection Name or UUID"/>

                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv">Status: </div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="certificate-request-search-status-criteria"> 
                                            <option value="EqualTo" data-i18n="select.is">is</option>
                                        </select>
                                        <select class="ddlBox_small_Border" id="certificate-request-search-status"> 
                                            <option value=''>All</option>
                                            <option>New</option>
                                            <option>Pending</option>
                                            <option>Done</option>
                                            <option>Error</option>
                                        </select>

                                        <input type="text" class="textBox_special_small" style="width: 295px;" id="certificate-request-search-selection" name="selection" placeholder="Selection Name or UUID"/>

                                    </div>
                                </div>


                                <input type="submit" class="uploadButton" value="Search" onclick="ws.searchCertificateRequests(this); return false;"/>

                            </form>

                            <div class="singleDiv" style="height: 50px;"></div>
                            <div id="nameOfPage" class="NameHeader">Browse Certificate Requests</div> 
                            <!--h2>Browse Certificate Requests</h2-->

                            <div  class="tableDisplayScroll_small">
                            <table id="certificate-request-browse-table" class="tableDisplayBind" style="width: 600px;">
                                <thead>
                                    <tr>
                                        <th class="row9">Subject (host uuid)</th>
                                        <th class="row9">Selection</th>
                                        <th class="row9">Status</th>
                                        <th class="row12" style="width: 300px;"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="evenRow" data-bind-each-item="certificateRequests">
                                        <td align="center" class="row1" data-bind-text="item.subject | escapeAttribute"></td>
                                        <td align="center" class="row2" data-bind-text="item.selection | escapeAttribute"></td>
                                        <td align="center" class="row3" data-bind-text="item.status | escapeAttribute"></td>
                                        <td align="center" class="row4"><a data-bind-uuid="item.uuid" href="#" onclick="javascript:ws.removeCertificateRequest(this.getAttribute('uuid')); return false;">delete</a></td>
                                    </tr>
                                </tbody>
                            </table>
                            </div>
                            </div>

                            <!-- <div class="singleDiv" style="height: 25px;"></div> -->
                            <!--div id="nameOfPage" class="NameHeader">Search Certificates</div--> 
                            <div id="nameOfPage" class="NameHeader" style="margin-bottom: 6px;"><span data-i18n="header.certificate_browse">Browse Certificates</span>&nbsp;&nbsp; 
                                <a href="javascript:toggleElementVisibility('certificate-search-form')" style='font-size: 0.8em'>(<span data-i18n="link.search">Search</span>)</a>
                            </div> 

                            <form id="certificate-search-form" action="#" onsubmit="return false;" style="display: none">

                                <div class="singleDiv">
                                    <div class="labelDiv" data-i18n="input.subject">Subject:</div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="certificate-search-subject-criteria"> 
                                            <option value="EqualTo" data-i18n="select.is">is</option>
                                            <option value="Contains" data-i18n="select.contains">contains</option>
                                        </select>

                                        <input type="text" class="textBox_Border" style="width: 395px;" id="certificate-search-subject"  name="subject" data-i18n="[placeholder]placeholder.host_uuid"/>

                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv" data-i18n="input.issuer">Issuer:</div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="certificate-search-issuer-criteria"> 
                                            <option value="EqualTo" data-i18n="select.is">is</option>
                                            <option value="Contains" data-i18n="select.contains">contains</option>
                                        </select>

                                        <input type="text" class="textBox_Border" style="width: 395px;" id="certificate-search-issuer" name="issuer" data-i18n="[placeholder]placeholder.issuer_name"/>

                                    </div>
                                </div>

                                 <div class="singleDiv">
                                    <div class="labelDiv" data-i18n="input.validity_date">Validity Date:</div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="certificate-search-valid-criteria"> 
                                            <option value="On" data-i18n="select.on">on</option>
                                            <option value="Before" data-i18n="select.before">before</option>
                                            <option value="After" data-i18n="select.after">after</option>
                                        </select>

                                        <input type="text" class="textBox_Border" style="width: 395px;" id="certificate-search-valid" name="valid" data-i18n="[placeholder]placeholder.date" onblur='(function(){var currentValue = $("certificate-search-valid").value; if( currentValue ) { var parsedValue = Date.parse(currentValue); if( parsedValue ) { $("certificate-search-valid").value = parsedValue.toISOString(); }}})()'/>
                                        <script>console.log("timedelta is "+ajax.timeDelta); document.getElementById('certificate-search-valid').value = Date.parse('now').addMilliseconds(ajax.timeDelta).toISOString()</script>
                                        <span class="help" data-i18n="label.date_hint">Try "today", "next tuesday", or most reasonable date formats</span>

                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv" data-i18n="input.sha1">SHA-1:</div> 
                                    <div class="valueDiv">
                                        <input type="text" class="textBox_Border" style="width: 395px;" id="certificate-search-sha1" name="sha1" data-i18n="[placeholder]placeholder.hex_40_chars"/>
                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv" data-i18n="input.sha256">SHA256:</div> 
                                    <div class="valueDiv">
                                        <input type="text" class="textBox_Border" style="width: 395px;" id="certificate-search-sha256" name="sha256" data-i18n="[placeholder]placeholder.hex_64_chars"/>
                                    </div>
                                </div>

                                <!--div class="singleDiv">
                                    <div class="labelDiv" data-i18n="input.pcr_event">PCR Event:</div> 
                                    <div class="valueDiv">
                                        <input type="text" class="textBox_Border" style="width: 395px;" id="certificate-search-pcrEvent" name="pcrEvent" data-i18n="[placeholder]placeholder.hex_40_chars"/>
                                    </div>
                                </div-->

                                <div class="singleDiv">
                                    <div class="labelDiv" data-i18n="input.status">Status:</div> 
                                    <div class="valueDiv">
                                        <input type="hidden" id="certificate-search-revoked-criteria" value=""/>
                                        <select class="ddlBox_small_Border" id="certificate-search-revoked">
                                            <option value="" data-i18n="select.any">Any</option>
                                            <option value="false" data-i18n="select.active" selected>Active</option>
                                            <option value="true" data-i18n="select.revoked">Revoked</option>
                                        </select>

                                        <input type="submit" class="uploadButton" id="searchCertButton" value="Search" data-i18n="[value]button.search" onclick="ws.searchCertificates(this); return false;"/>
                                        <input type="button" class="uploadButton" id="searchCertButton" value="Cancel" data-i18n="[value]button.cancel" onclick="$('certificate-search-form').reset(); toggleElementVisibility('certificate-search-form'); ws.searchCertificates(this); return false;"/>
                                    </div>
                                </div>
                            <div class="singleDiv" style="height: 8px;"></div>

                            </form>

                            <form id="certificate-provision-form" style="display: none;" action="#" onsubmit="return false;" >
                                <p>Currently push-provisioning works only with Citrix Xen hosts and Intel Trust agents and must currently be registered in Mt. Wilson.</p>
                                <input type="hidden" name="certificateUuid" id="certificate-provision-uuid"/>
                                <ul>
                                    <li>
                                        <label for="certificate-provision-host">Internet Address</label>
                                        <input type="text" id="certificate-provision-host" name="host" size="40" placeholder="Hostname or IP Address"/>
                                    </li>
                                    <!-- 
                                    <li>
                                        <label for="certificate-provision-username">Username</label>
                                        <input type="text" id="certificate-provision-username" name="username" placeholder="Username"/>
                                    </li>
                                    <li>
                                        <label for="certificate-provision-password">Password</label>
                                        <input type="password" id="certificate-provision-password" name="password" placeholder="Password"/>
                                    </li>
                                    -->
                                     <li>
                                            <input type="button" value="Provision" onclick="ws.provisionCertificate(this); return false;"/>
                                            <input type="button" value="Cancel" onclick="$('certificate-provision-form').hide(); return false;"/>
                                     </li>
                                </ul>
                            </form>

                            <div>
                                <table class="tableDisplayBind" cellpadding=0 cellspacing=0>
                                    <thead>
                                        <tr>
                                            <th class="row9" data-i18n="label.host_id">Subject (Host Name)</th>
                                            <th class="row9" data-i18n="label.issuer">Issuer</th>
                                            <th class="row9" data-i18n="label.not_before">Not Before</th>
                                            <th class="row9" data-i18n="label.not_after">Not After</th>
                                            <th class="row9" data-i18n="label.status">Status</th>
                                            <th class="row9" data-i18n="label.sha1_fingerprint">Fingerprint (SHA-1)</th>
                                            <th class="row9" data-i18n="label.sha256_fingerprint">Fingerprint (SHA256)</th>
                                            <th class="row9"></th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                            <div class="tableDisplayScroll_big">
                            <table id="certificate-browse-table" class="tableDisplayBind" cellpadding=0 cellspacing=0>
                                <tbody>
                                    <tr class="evenRow" data-bind-each-item="certificates">
                                        <!--td class="row9" align="center" data-bind-text="item.subject | escapeAttribute"></td-->
                                        <td class="row9" align="center" data-bind-text="item.subjectName | escapeAttribute"></td>
                                        <td class="row9" align="center" data-bind-text="item.issuer | escapeAttribute"></td>
                                        <td class="row9" align="center" data-bind-text="item.not_before | isodate"></td>
                                        <td class="row9" align="center" data-bind-text="item.not_after | isodate"></td>
                                        <td class="row9" align="center" data-bind-text="item.status | escapeAttribute | translate"></td>
                                        <td class="row9" align="center" data-bind-text="item.sha1  | escapeAttribute | wrap 16"></td>
                                        <td class="row9" align="center" data-bind-text="item.sha256 | escapeAttribute | wrap 16"></td>
                                        <td class="row9 last_col" align="center">
                                            <!--
                                            <a data-bind-uuid="item.id" href="#" onclick="javascript:ws.deleteCertificate(this.getAttribute('uuid')); return false;">Delete</a> &nbsp;
                                            -->
                                            <a data-bind-uuid="item.id" href="#" data-i18n="link.deploy" onclick="javascript:$('certificate-provision-uuid').value=this.getAttribute('uuid'); $('certificate-provision-form').show();  $('certificate-provision-host').focus(); return false;">Deploy</a> &nbsp;
                                            <a href="" data-i18n="link.download" onmouseover="$(this).download = $(this).getAttribute('filename') + '.crt';$(this).href='data:application/octet-stream;base64,'+($(this).next('span').innerHTML);"  data-bind-filename="item.subject">Download</a><span style="display:none;" data-bind-text="item.certificate"></span> <br /><br />
                                            <a data-bind-uuid="item.id" href="#" data-i18n="link.import" onclick="javascript:ws.deployCertificate(this.getAttribute('uuid')); return false;">Import</a>&nbsp;
                                            <a data-bind-uuid="item.id" href="#" data-i18n="link.revoke" onclick="javascript:ws.revokeCertificate(this.getAttribute('uuid')); return false;">Revoke</a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            </div>



                        </div> <!-- end certificates tab -->

                        <div id="provisionTag"> <!-- Begin Tag Provisioning div -->
			<div id='provisionTagFormDiv'>
                            <form id="tag-prov-form" style="display: block;" onsubmit="return false;">
			    	<div class='provisionStep' data-i18n="header.servers_to_provision">Step 1: Select the servers to provision the tags</div>
				<select multiple="multiple" id="my-select" name='my-select-inp'>
				   <option data-bind-each-item="global.hosts" data-bind-value="item.name | escapeAttribute " data-bind-text="item.name | escapeAttribute "></option> 
    				</select>
				<small><i data-i18n="label.double_click_status">Double click on the element to toggle the status</i></small>

			    	<div class='provisionStep' data-i18n="header.choose_tag_selection">Step 2: Choose the Tag selection</div>
				<div class='tagSelectionsDiv' id='tagSelectionsDiv'>
				&nbsp;&nbsp;<a class='prov_choose_sel_link prov_choose_sel_link_selected' href='javascript:openProvisionSelectionOptions("availSelectionsDiv")' id="availSelectionsDiv_link" data-i18n="label.available_selections">Available Selections</a>&nbsp;<a class='prov_choose_sel_link' href='javascript:openProvisionSelectionOptions("selectionFileDiv")' id="selectionFileDiv_link" data-i18n="label.upload_xml">Upload XML</a><br />
					<div id='selectionFileDiv' class='prov_sel_option'>
						<input id='fileForUpload' type='file' name='userFile' onChange='getFileContents()'>
					</div>
					<div class='tagSelectionsDiv prov_sel_option' id='availSelectionsDiv'>
						<table name='provision-sel-details' id='provision-avail-sel' class='ms-list tableDisplayBind' cellspacing=0 cellpadding=0>
                                                	<tr  data-bind-each-item='global.selections' style='height: 30px'>
								<td align="center" data-bind-text="item.name | escapeAttribute" data-bind-selId="item.id | escapeAttribute" class='ms-elem-selectable selection_entry' data-bind-id='item.id' onClick='getSelectedSelectionDetails(this.getAttribute("selId"))'></td>
							</tr>
						</table>
					</div>
				</div>
				<div class='tagSelectionsDiv' id='tagSelectionsDetailsDiv'>
					<table style='width: 100%; height: 100%' name='provision-sel-details' id='provision-sel-details' class='ms-list tableDisplayBind' cellspacing=0 cellpadding=0>
                                                <tr  data-bind-each-item='global.selection_details'>
							<td align="center" data-bind-text="item.kv_attribute_name | escapeAttribute " class='ms-elem-selectable attribute_name'></td>
							<td align="center" data-bind-text="item.kv_attribute_value | escapeAttribute " class='ms-elem-selectable attribute_value'></td>
						</tr>
					</table>
				</div>

				<hr style='clear:both' />
                                <input type="submit" class="uploadButton" value="Provision" data-i18n="[value]button.provision" onClick="provisionTags(); return false">
			    </form>
			</div>
			<div id='provisionTagProgDiv' style="display: none">
			    <div class='provisionStep'>Status: Tag Provisioning</div><br />
			    <table class="tableDisplayBind" id='provision-sel-table' name='provision-sel-table'  style="width: 800px;" cellpadding=0 cellspacing=0>
				<thead>
                                        <th class="col_tag_names">Server IP/Name</th>
                                        <th class="col_tag_names">Status</th>
				</thead>
				<tbody>
				<tr data-bind-each-item="selected_hosts" class="evenRow">
					<td class="col_auto" data-bind-text='item.subject | escapeAttribute '></td>
					<td style='border-right: 1px solid black' data-bind-text='item.status | escapeAttribute '></td>
				</tr></tbody>
			    </table>
			    <div id='hostProgressMessage' style='display: none; margin: 15px; font-size: 18px; font-weight: bold'><div>
			</div>
			</div><!-- End of Tag Provisioning div -->
                   
                        <div id="configure" style="display: none;">

                            <form id="configuration-search-form" style="display: none;" onsubmit="return false;">
                                <ul>
                                    <li>
                                        <label for="configuration-search-name">Name</label>
                                        <select id="configuration-search-name-criteria">
                                            <option value="EqualTo" data-i18n="select.is">is</option>
                                            <option value="Contains" data-i18n="select.contains">contains</option>
                                        </select>
                                        <input type="text" id="configuration-search-name" name="name" placeholder="Configuration name, eg 'main'"/>
                                    </li>
                                    <li style="display: none;">
                                        <label for="configuration-search-contentType">Content Type</label>
                                        <input type="hidden" id="configuration-search-contentType-criteria" value="EqualTo"/>
                                        <select id="configuration-search-contentType">
                                            <option>JSON</option>
                                        </select>
                                    </li>
                                    <li><input type="button" value="Search" onclick="ws.searchConfigurations(this); return false;"/></li>
                                </ul>
                            </form>

                            <div class="nagPanel">Settings &gt;</div>
                            <!--div id="nameOfPage" class="NameHeader">Server Configuration</div--> 

                            <form id="config-form" onsubmit="return false;">
                                <input type="button" id="config-save-button" value="Save" onclick="ws.storeMainConfiguration(this); return false;"/>
                                <!-- <input type="button" id="config-load-button" value="Reset" onclick="ws.retrieveMainConfiguration(); return false;"/> -->

                                <fieldset>
                                        <legend>Server Configuration</legend>
                                <br/>
                                Provisioning
                                <br/>

                                <div class="singleDiv">
                                    <div class="labelDiv">Allow tag selections in certificate requests: </div> 
                                    <div class="valueDiv">
                                        <select data-bind-value="input.allowTagsInCertificateRequests" class="ddlBox_small_Border" id="allow-tags-in-certificate-requests" name="allowTagsInCertificateRequests"> 
                                            <option value="true">Yes</option>
                                            <option value="false">No</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="singleDiv">
                                    <p>Choosing 'Yes' here enables the "Manual" and "Automatic Host-Based" provisioning request models.
                                            Note: for "Automatic Host-Based" provisioning you also need to configure a code signing certificate.</p>
                                </div>

                                <div class="singleDiv" style="height: 25px;"></div>
                                <div class="singleDiv">
                                    <div class="labelDiv">Allow server to automatically select tags for certificate requests: </div> 
                                    <div class="valueDiv">
                                        <select data-bind-value="input.allowAutomaticTagSelection" class="ddlBox_small_Border" id="allow-automatic-tag-selection" name="allowAutomaticTagSelection"> 
                                            <option value="true">Yes</option>
                                            <option value="false">No</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="singleDiv">
                                    <p>Choosing 'Yes' here enables the "Automatic Server-Based" provisioning request models.
                                            Note: for "Automatic Server-Based" provisioning you also need to set a tag selection policy.</p>
                                </div>

                                <div class="singleDiv" style="height: 25px;"></div>
                                <div class="singleDiv">
                                    <div class="labelDiv">Choose a tag selection to use for all certificate requests: </div> 
                                    <div class="valueDiv">
                                        <select data-bind-value="input.automaticTagSelectionName" class="ddlBox_small_Border" id="automatic-tag-selection-name" name="automaticTagSelectionName"> 
                                            <option data-bind-each-item="global.selections" data-bind-value="item.uuid" data-bind-text="item.name"></option> 
                                        </select>
                                    </div>
                                </div>
                                <div class="singleDiv">
                                    <p>If you use "Automatic Server-Based" provisioning, the server needs to know which tag selection
                                            to use for incoming certificate requests. Currently only one tag selection is supported.</p>
                                </div>

                                <div class="singleDiv" style="height: 25px;"></div>
                                <div class="singleDiv">
                                    <div class="labelDiv">Approval Method: </div> 
                                    <div class="valueDiv">
                                        <select data-bind-value="input.approveAllCertificateRequests" class="ddlBox_small_Border" id="approval-method" name="approveAllCertificateRequests"> 
                                            <option value="true">Automatic/internal</option>
                                            <option value="false">Manual/external</option>
                                        </select>
                                    </div>
                                </div>

                                </fieldset>

                                <div class="singleDiv" style="height: 25px;"></div>
                                <div style="display: none;">
                                <fieldset>
                                    <legend>Mt Wilson</legend>

                                    <div class="singleDiv">
                                        <div class="labelDiv">MtWilson Base URL (https://mtwilson:port/) </div> 
                                        <div class="valueDiv">
                                            <input type="text" class="textBox_Border" data-bind-value="mtwilsonUrl" id="mtwilson-url" name="mtwilsonUrl"/>
                                        </div>
                                    </div>

                                    <div class="singleDiv" style="height: 25px;"></div>
                                    <div class="singleDiv">
                                        <div class="labelDiv">MtWilson API Client Username</div> 
                                        <div class="valueDiv">
                                            <input type="text" class="textBox_Border" data-bind-value="mtwilsonClientKeystoreUsername" id="mtwilson-client-keystore-username" name="mtwilsonClientKeystoreUsername"/>
                                        </div>
                                    </div>

                                    <div class="singleDiv" style="height: 25px;"></div>
                                    <div class="singleDiv">
                                        <div class="labelDiv">MtWilson API Client Password</div> 
                                        <div class="valueDiv">
                                            <input type="password" class="textBox_Border" data-bind-value="mtwilsonClientKeystorePassword" id="mtwilson-client-keystore-password" name="mtwilsonClientKeystorePassword"/>
                                        </div>
                                    </div>                               

                                </fieldset>
                                </div>
                            </form>

                            <!-- <div class="singleDiv" style="height: 25px;"></div> -->
                              <!-- since there is a create-ca-key command now, disabling this forma nd just showing the cacerts for import to mt wilson -->
                            <form id="ca-update-form">
                                <fieldset>
                                    <legend>Certificate Authority</legend>
                                    <p>A certificate authority is automatically created during a new install. 
                                        You can update the authority information here. Updating the authority information
                                        will cause the existing certificate authority to be revoked and a new one to be
                                        created with the updated information.</p>
                                    <p>To create a new CA, use the "create-ca-key" command on the asset tag server.</p>
                                    <ul style="display: none;"> 
                                        <li><label for="ca-cn">Common Name</label><input type="text" id="ca-cn" size="30" data-bind-value="input.cn" placeholder="First Name &amp; Last Name" class="required"/></li>
                                        <li><label for="ca-ou">Organizational Unit</label><input type="text" id="ca-ou" size="30" data-bind-value="input.ou" placeholder="Department" value="Cloud Security" class="required"/></li>
                                        <li><label for="ca-o">Organization</label><input type="text" id="ca-o" size="30" data-bind-value="input.o" placeholder="Organization or Company" value="Intel" class="required"/></li>
                                        <li><label for="ca-l">Locality</label><input type="text" id="ca-l" size="30" data-bind-value="input.l" placeholder="City" value="Folsom" class="required"/></li>
                                        <li><label for="ca-st">State</label><input type="text" id="ca-st" size="30" data-bind-value="input.st" placeholder="State or Province" value="CA" class="required"/></li>
                                        <li><label for="ca-c">Country</label><input type="text" id="ca-c" size="30" data-bind-value="input.c" placeholder="Country" value="US" class="required"/></li>
                                        <li><input type="button" value="Update" onclick="ws.updateCertificateAuthority(this);"/></li>
                                    </ul>
                                    <!-- not using data binding right now because we're not supporting updating the file... but we will later to allow user to import external ca certs by just appending them here -->
                                    <textarea id="cacerts-text" rows='20' cols='80'></textarea>
                                </fieldset>
                            </form>

                            <!-- end configure tab -->
                        </div>       
                    </div>

                    <div id="log">
                        <h1>Application Log</h1>
                        <div id="logwindow" style="height: 400px; max-height: 400px; overflow: scroll; border: 2px solid #555555; margin-top: 15px; padding: 4px;">
                        </div>
                        <!-- end log tab -->
                    </div>
                    <!-- content-wrap ends-->	
                </div>
            </div>
            <div>
                <span id="alert_valid_ca" data-i18n="alert.valid_ca" style="display: none;">form is valid, update ca</span>
                <span id="alert_not_valid_ca" data-i18n="alert.not_valid_ca" style="display: none;">form NOT valid, update ca</span>
                <span id="alert_provision_select_tag_xml" data-i18n="alert.provision_select_tag_xml" style="display: none;">Please select the tag XML to be provisioned.</span>
                <span id="alert_provision_select_server" data-i18n="alert.provision_select_server" style="display: none;">Select at least one server to provision the tags</span>
                <span id="alert_provision_upload_tag_xml" data-i18n="alert.provision_upload_tag_xml" style="display: none;">Upload a tag XML or choose a selection to provision</span>
            </div>
            
            <!-- footer starts -->
            <div class="footer" style="display: none;">
                <p>&copy; 2012-2013 Intel Corporation.<br/></p>
            </div>
            <!-- footer ends-->	


        <!-- configure javascript logging -->								
        <script>
            log.attach("logwindow");
        </script>

        <!-- script must be at the end of the markup so it can reference any element -->
        <script>
            // this section initializes the user interface   
            var navTabs = new Control.Tabs('navtabs', {
                activeClassName: 'current',
                setClassOnContainer: true,
                afterChange: function(new_container) {
                    if(new_container.id == 'tags') {
                        //                        onUpdateVoterIssues();
                    }
                    if(new_container.id == 'certificates') {
                        //                        onDisplayTally();
                    }
                }
            });
            
            
            navTabs.setActiveTab( (""+document.location).toQueryParams().tab );

            $('certificate-provision-form').hide();

	/*function provisionTags() {
		alert('IN here');
 $.ajaxFileUpload({
        url: 'getData/getUploadedFileContents.html',
        secureuri: false,
        fileElementId: 'fileToUpload',
        dataType: 'jsonp',
        headers: {
            "AuthorizationToken": authorizationToken // part of fix for issue #1038, see commonUtils.js
        },
        success: function(data, status) {
            fnuploadSuccess(data);
        },
        error: function(data, status, e) {
            $('#successMessage').html('<div class="errorMessage">* Error authenticating the user.</div>');
        }
    });
  }*/


        </script>


        <script>
            //log.debug("adapter: "+rivets_watch_findx_adapter);
            //rivets-test
            //var taglist = [ {name:"tag1",oid:"1.1"}, {name:"tag2",oid:"2.2" } ];
            //var taglist = [ "hello", "world" ];
            //var taglist = [ [{name:"hello"}, {name:"world"}] ];
            //var myview = rivets.bind(document.getElementById('rivets-test'), { tags: [ {item:"hello"},{item:"world"}] }); // instead of sampledata.tags
            // *** these were enabled ***
            var alertView, tagview, rdfview, selectionview, tagviewCertificateRequests, certificateView /*, appview */, configurationView;
            //
            //taglist.push("test");
            //myview.build();
            //mybindings.update({filter: mytags});
            //sampledata.tags.push({"name":"new tag","oid":"1.2.3.4","values":["hello","world"]});
            // make sure all dom elements are loaded before initializing the web layer
	    /*$('certificates').show(function() {
	    });*/
            document.observe('dom:loaded', function() {
                ws.initialize({
                    options: {
                        baseurl: 'http://localhost:8080'
                    }
                    //views: { 'tags': tagview, 'rdf-triples': rdfview }
    //                data: sampledata, // optional: if not provided will start empty and then we can load it from server
    /*
                    view: { 'update': function(data) {
                            var i = mtwilson.rivets.views.length; // until they respond we don't know what these tags are;  
                            while(i--) {
                                mtwilson.rivets.views[i].update(data);
                            }
    // //                     appview.update(data); 
    //                        tagview.update(data);
    //                        rdfview.update(data);
    //                        selectionview.update(data);
    //  //                      tagviewCertificateRequests.update(data);
    //                        certificateView.update(data); 
    //                        configurationView.update(data);
                        },
                        'sync': function() {
                            var i = mtwilson.rivets.views.length; // until they respond we don't know what these tags are;  
                            while(i--) {
                                mtwilson.rivets.views[i].sync();
                            }
    ////                        appview.sync(); 
    //                        tagview.sync();
    //                        rdfview.sync();
    //                        selectionview.sync();
    // //                       tagviewCertificateRequests.sync();
    //                        certificateView.sync(); 
    //                        configurationView.sync();
                        }
                    }*/
                });
		document.getElementById("searchCertButton").click();
//		ws.searchCertificates(this);
                log.debug("done initializing ws");
            });

	    function toggleElementVisibility(element_id) {
		$(element_id).toggle();
	    }
            
            //alertView = rivets.bind(document.getElementById('notifications'), ws.data);

//            appview = rivets.bind(document.getElementById('main'), ws.data); 
//            tagview = rivets.bind(document.getElementById('tag-browse-table'), ws.data); 
//            rdfview = rivets.bind(document.getElementById('rdf-triple-browse-table'), ws.data); 
//            selectionview = rivets.bind(document.getElementById('selection-browse-table'), ws.data); 
////            tagviewCertificateRequests = rivets.bind(document.getElementById('certificate-request-create-form'), ws.data); 
//            certificateView = rivets.bind(document.getElementById('certificate-browse-table'), ws.data); 
//            configurationView = rivets.bind(document.getElementById('config-form'), ws.data.currentConfiguration); 

            // wait for the webservice library to initialize, then populate the UI with some data from the server. 
            document.observe('mtwilson:ready', function() {
                log.debug("after init (mtwilson:ready), data: "+Object.toJSON(ws.data));
                ws.searchTags('tag-search-form');
                // ws.searchRdfTriples('rdf-triple-search-form');
                ws.searchSelections('selection-search-form');
//                ws.searchConfigurations('configuration-search-form');
                ws.loadCaCerts();
		ws.loadHostsForProvisioning();
//                ws.retrieveMainConfiguration();
                i18nInit();
            });
            
        </script>
    </body>
</html>
