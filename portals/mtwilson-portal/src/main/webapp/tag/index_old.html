<!DOCTYPE html>



<html lang="en">

    <head>
                
        <title>Asset Tag Reference Implementation </title>
        <meta name="application-name" content="Mt Wilson Asset Tag Reference Implementation"/>
        <meta name="description" content="A web-based tool for defining tags and provisioning asset certificates" />
        <meta name="keywords" content="Mt Wilson, attestation, asset, inventory, management, security, cloud, data center" />
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />

        <link rel="resources" type="application/vnd.mtwilson.resource+json" href="/resources.json">
        
        <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
                
        <!-- Add mtwilson libraries -->
        <!--link rel="stylesheet" href="images/at.css" type="text/css" /-->
        <link rel="stylesheet" type="text/css" href="../CSS/home.css" />
        <link rel="stylesheet" type="text/css" href="../CSS/JQueryHelperCSS/jquery.ui.menubar.css" />
        <link rel="stylesheet" type="text/css" href="../CSS/JQueryHelperCSS/style.css" />
        
        <script type="text/javascript" src="../Scripts/JQuery/jquery-1.7.2.js"></script>
        <script type="text/javascript" src="../Scripts/JQuery/jquery.json-1.3.min.js"></script>
        <script type="text/javascript" src="../Scripts/JQuery/jquery.ui.core.js"></script>
        <script type="text/javascript" src="../Scripts/JQuery/jquery.ui.dialog.js"></script>
        <script type="text/javascript" src="../Scripts/JQuery/jquery.effects.core.js"></script>
        <script type="text/javascript" src="../Scripts/JQuery/jquery.ui.widget.js"></script>
        <script type="text/javascript" src="../Scripts/JQuery/jquery.ui.position.js"></script>
        <script type="text/javascript" src="../Scripts/JQuery/jquery.ui.menu.js"></script>
        <script type="text/javascript" src="../Scripts/JQuery/jquery.ui.menubar.js"></script>
        <script type="text/javascript" src="../Scripts/JQuery/jquery.paginate.js"></script>
        <script type="text/javascript" src="../Scripts/ajaxfileupload.js"></script>
        <script type="text/javascript" src="../Scripts/JQuery/jquery.popupWindow.js"></script>
          
     
        <script src="../watch.js" type="text/javascript"></script> <!-- required to use rivets -->
        <script src="../prototype-1.7.1.js" type="text/javascript"></script> <!-- required by log.js -->
        
        
        <!-- ui tools -->
        <script src="../scriptaculous-1.9.0/scriptaculous.js" type="text/javascript"></script> 
        <script src="../livepipe/livepipe.js" type="text/javascript"></script>
        <script src="../livepipe/contextmenu.js" type="text/javascript"></script>
        <script src="../livepipe/cookie.js" type="text/javascript"></script>
        <script src="../livepipe/event_behavior.js" type="text/javascript"></script>
        <script src="../livepipe/hotkey.js" type="text/javascript"></script>
        <script src="../livepipe/progressbar.js" type="text/javascript"></script>
        <script src="../livepipe/rating.js" type="text/javascript"></script>
        <script src="../livepipe/resizable.js" type="text/javascript"></script>
        <script src="../livepipe/scrollbar.js" type="text/javascript"></script>
        <script src="../livepipe/selection.js" type="text/javascript"></script>
        <script src="../livepipe/selectmultiple.js" type="text/javascript"></script>
        <script src="../livepipe/tabs.js" type="text/javascript"></script>
        <script src="../livepipe/textarea.js" type="text/javascript"></script>
        <script src="../livepipe/window.js" type="text/javascript"></script>
        <script src="../URI.js" type="text/javascript"></script>
        <script src="../validation.js" type="text/javascript"></script>
        <script src="../input.js" type="text/javascript"></script>
        <script src="../array.js" type="text/javascript"></script>
        <script src="../merge.js" type="text/javascript"></script>
        <script src="../date.js" type="text/javascript"></script> <!-- required by log.js -->
        <script src="../log.js" type="text/javascript"></script> <!-- requires prototype.js, date.js -->
        <script src="../form.js" type="text/javascript"></script>
        <script src="../rivets.js" type="text/javascript"></script>
        <script src="../findx.js" type="text/javascript"></script>
        <script src="../rivets-adapter-watch-findx.js" type="text/javascript"></script> <!-- requires rivets, watch.js, and findx -->

        <script src="../base64.js" type="text/javascript"></script>
        <script src="../ajax.js" type="text/javascript"></script>
        <script src="../atclient.js" type="text/javascript"></script>
        
        <script type="text/javascript" src="../Scripts/commonUtils.js"></script>
        <script type="text/javascript" src="../Scripts/CommonMessage.js"></script>
        <script type="text/javascript" src="../Scripts/home.js"></script>



        <script type="text/javascript">
            var ws = mtwilson.atag; // local name for the asset tag web service
        </script>

        <script type="text/javascript">
// credit for isNumber (creative commons share alike 3.0) http://stackoverflow.com/questions/18082/validate-numbers-in-javascript-isnumeric/1830844#1830844
function isNumber(n) {
  return !isNaN(parseFloat(n)) && isFinite(n);
}            
            
            // watch adapter, from https://github.com/mikeric/rivets/wiki/Adapters
            rivets.configure({
                adapter: rivets_watch_findx_adapter,
                prefix: 'bind' // so data binding happens for data-bind-whatever attributes (instead of data-whatever) ; which allows us to use input.js because it uses data-alt.
                /*
                binders: {
                    'alt': function(el,value) { } // do nothing; this allows input.js to continue using data-alt for its default display text. another way to do it would be to use the 'prefix' configuration of rivets like  prefix:'bind' and then use data-bind-whatever instead of just data-whatever in the forms.
                }
                 */
            });
            
            // input like timestamp 1377839054000 or text date format like yyyy-MM-dd, output like:  2013-08-30T05:04:14.000Z
                rivets.formatters.isodate = function(value) {
                        if( isNumber(value) ) {
                            return new Date(value).toISOString();
                        }
                        else {
                            return Date.parse(value).toISOString();
                        }
                    };
                rivets.formatters.date = function(value) {
                        if( isNumber(value) ) {
                            return new Date(value).toString();
                        }
                        else {
                            return Date.parse(value).toString();
                        }
                    };
                    // input any value that evaluates to true/false, output either "yes" or "no" or replace those with your own "yes value" and "no value" for example "Active" and "Inactive" instead of "yes" and "no"
               rivets.formatters.yesno = function(value,yestext,notext) {
                   if( value ) {
                       return yestext ? yestext : "yes";
                   }
                   else {
                       return notext ? notext : "no";
                   }
               };
               // input any hex or base64 value and this will return the value with newlines inserted
               rivets.formatters.wrap = function(text,columns,sep) {
                   var i=0, result="";
                   columns = columns ? parseInt(columns) : 20;
                   sep = sep || " ";
                   log.debug("wrap text: "+text+"  length: "+text.length+"  columns: "+columns);
                   while(i<text.length) { result += text.slice(i,i+columns) + sep; i += columns; }
                   log.debug("wrap result: "+Object.toJSON(result));
                   return result;
               };
               
//                }


            
        </script>
        

    </head>
    
    <body style="background: #ffffff">
        
            <style>
                li
                {
                display:inline;
                }
            </style>
 

            <!--header -->
            <div id="innerHeader_mtw" class="header" style="display: none;">
                <div class="title"><h1>Mt. Wilson</h1></div>
                
                <div class="clear hideSkiplink">
                    <div id="NavigationMenu" class="menu" style="float: left;">
                        <!--ul id="menubarItems" style="display: inline;">
                             <li>
                                <a>Asset Tag Management</a>
                                <ul id="navtabs">
                                    <li><a href="#tags">Tag Creation</a></li> 
                                    <li><a href="#selections">Tag Selection</a></li>
                                    <li><a href="#certificates">Certificate Management</a></li>
                                    <li><a href="#configure">Settings</a></li>
                                    <li><a href="#log">Log</a></li>

                                </ul>
                            </li>
                        </ul-->
                        
                        <nav id="nav">
                            <ul id="navtabs"> 
                                <li ><a href="#tags">Tag Creation</a></li>  
                                <li ><a href="#selections">Tag Selection</a></li>
                                <li ><a href="#certificates">Certificate Management</a></li>			
                                <li ><a href="#configure">Settings</a></li>
                                <li ><a href="#log">Log</a></li>
                            </ul>
                        </nav>		

                    </div>
                    <div style="clear: left;"></div><a id="NavigationMenu_SkipLink"></a>
                </div>
            </div>
            				
            <div id="ajaxstatus" style="clear: both; width: 840px; height: 20px; max-height: 50px;  margin-top: 0px; padding: 4px;">
            </div>
           
            <div class="main" id="mainContainer">
                <!-- content-wrap starts -->
                <!--div id="content-wrap" class="one-col"  -->	
                <div class="container" id="tagsMainContainer">

                    <div id="main">

                        <div id="tags">
                            <script>
                                function tag_create_form_addValue() {
                                    mtwilson.rivets.forms['tag-create-form'].input.mergeInsert({values:[]}); // sets the values to empty array if it's not already defined (applies first time this function is called)
                                    var value = (""+$F('tag-create-values')).strip();
                                    if( value.empty() ) { return; }
                                    //        alert("add value: "+value);
                                    log.debug("uh? "+Object.toJSON(mtwilson.rivets.forms['tag-create-form']));
                                    mtwilson.rivets.forms['tag-create-form'].input.values.push($F('tag-create-values')); 
                                    $('tag-create-values').focus(); 
                                    $('tag-create-values').clear();        
                                }
                                function tag_create_form_removeValue(tagValue) {
                                    mtwilson.rivets.forms['tag-create-form'].input.values.removeAll(tagValue); 
                                    mtwilson.rivets.views['tag-create-form'].sync(); 
                                }
                                // called when submitting the form... checks that at least one value was added
                                function tag_create_form_validateValues() {
                                    return mtwilson.rivets.forms['tag-create-form'].input.values.length > 0;
                                }
                            </script>
                            
                            <div class="nagPanel">Asset Tag Management &gt;</div>
                            <div id="nameOfPage" class="NameHeader">Create New Tag</div> 
                            
                            <form id="tag-create-form">

                                    <div class="singleDiv">
                                    <div class="labelDiv">Tag name : </div>
                                    <div class="valueDiv">
                                        <input type="text" class="textBox_Border" id="tag-create-name" data-bind-value="input.name" placeholder="Tag name">
                                        <span class="requiredField">*</span>
                                    </div>
                                    </div>

                                    <div class="singleDiv">
                                    <div class="labelDiv">Tag OID(optional)</div>    
                                    <div class="valueDiv">
                                        <input type="text" class="textBox_Border" id="tag-create-oid" data-bind-value="input.oid" placeholder="2.5.4.789.1">
                                    </div>
                                    </div>


                                    <div class="singleDiv" style="height: 66px;">
                                        <div class="labelDiv">Tag values</div> 
                                         <div class="valueDiv">
                                            <input type="text" class="textBox_Border" id="tag-create-values" placeholder="Value"  data-validator="tag_create_form_validateValues">


                                         </div>
                                        <div class="valueDiv">
                                            <input type="button" class="uploadButton" value="Add" onclick="tag_create_form_addValue();">
                                            <input type="button" class="uploadButton" value="Save" onclick="ws.createTag(this); return false;">

                                            <span style="display: none;" class="validation-advice" id="advice-tag-create-values">You must add at least one value.</span>
                                            <ul style="max-width: 600px; margin-left: 0px; padding-left: 0px; list-style: none;">
                                                <li style="display: inline-block; border: 1px solid black; border-radius: 3px; padding-left: 5px; padding-right: 5px; margin: 3px;" data-bind-each-item="input.values"><span data-bind-text="item"></span> <a data-bind-tagValue="item" href="#" style="color: red; font-weight: bold;" onclick="javascript:tag_create_form_removeValue(this.getAttribute('tagValue'));">X</a></li>
                                            </ul>


                                        </div>
                                    </div> 


                            </form>

                            <div id="nameOfPage" class="NameHeader">Search Tags</div> 

                            <form id="tag-search-form" action="#" onsubmit="return false;">


                                    <div class="singleDiv">
                                        <div class="labelDiv">Tag name:</div> <!-- was: "Host Provided By" -->
                                        <div class="valueDiv">
                                            <select class="ddlBox_small_Border" id="tag-search-name-criteria">
                                                <option value="EqualTo">is</option>
                                                <option value="Contains">contains</option>
                                            </select>
                                            <input type="text" class="textBox_special_small" id="tag-search-name" name="name" placeholder="Tag name">
                                        </div>
                                    </div>

                                    <div class="singleDiv">
                                        <div class="labelDiv">Tag OID:</div> <!-- was: "Host Provided By" -->
                                        <div class="valueDiv">
                                            <select class="ddlBox_small_Border" id="tag-search-oid-criteria">
                                                <option value="EqualTo">is</option>
                                                <option value="Contains">contains</option>
                                            </select>
                                            <input type="text"  class="textBox_special_small" id="tag-search-oid" name="oid" placeholder="Tag OID">
                                        </div>
                                    </div>

                                    <div class="singleDiv">
                                        <div class="labelDiv">Tag value:</div> 
                                        <div class="valueDiv">
                                            <select class="ddlBox_small_Border" id="tag-search-value-criteria">
                                                <option value="EqualTo">is</option>
                                                <option value="Contains">contains</option>
                                            </select>
                                            <input type="text"  class="textBox_special_small" id="tag-search-value" name="value" placeholder="Tag value">
                                        </div>
                                    </div>

                                    <input type="button" class="uploadButton" value="Search..." onclick="ws.searchTags(this); return false;">

                            </form>

                            <div class="singleDiv" style="height: 66px;"></div>
                            <div id="nameOfPage" class="NameHeader">Browse Tags</div> 

                            <div  class="tableDisplayScroll_small">
                            <table id="tag-browse-table" class="tableDisplayBind" style="width: 600px;">
                                <thead>
                                    <tr>
                                        <th class="row9">Tag name</th>
                                        <th class="row9">Tag OID</th>
                                        <th class="row9">>Tag values</th>
                                        <th class="row12" style="width: 300px;"></th>
                                    </tr>
                                </thead>

                                <tbody>
                                    <tr class="evenRow" data-bind-each-item="tags">
                                        <td align="center" class="row1" data-bind-text="item.name"></td>
                                        <td align="center" class="row2" data-bind-text="item.oid"></td>
                                        <td align="center" class="row3" style="max-width: 400px;">
                                            <ul style="margin-left: 0px; padding-left: 0px; list-style: none;">
                                                <li style="display: inline-block; list-style-type: inline; border: none; padding: 1px; margin: 3px;" data-bind-each-item="item.values"><span style="text-decoration: underline;" data-bind-text="item"></span></li>
                                            </ul>
                                        </td>
                                        <td align="center" class="row4"><a data-bind-oid="item.oid" data-bind-uuid="item.uuid"  href="#" onclick="javascript:ws.removeTag(this.getAttribute('uuid')); return false;">delete</a></td>
                                    </tr>
                                </tbody>
                            </table>
                            </div>


                            <!-- end tags tab  -->
                        </div>

                        <div id="selections" >
                            <div class="nagPanel">Tag Selection &gt;</div>
                            <div id="nameOfPage" class="NameHeader">Create New Selection</div> 

                            <script>
                                function selection_create_form_init() {
                                    log.debug("selection_create_form_init: rivets forms: "+Object.toJSON(mtwilson.rivets.forms['selection-create-form'].input));
    //                                if( mtwilson.rivets.forms['selection-create-form'] ) {
                                        log.debug("selection_create_form_init: got selection-create-form");
                                        log.debug("selection_create_form_init: current tag data is: "+Object.toJSON(mtwilson.atag.data.tags));
                                        mtwilson.rivets.forms['selection-create-form'].input.name = ''; 
                                        mtwilson.rivets.forms['selection-create-form'].tagValues = [];
    //                                    mtwilson.rivets.forms['selection-create-form'].tags = mtwilson.atag.data.tags; // already part of global binding
                                        mtwilson.rivets.forms['selection-create-form'].input.selection = [];
                                        // and initialize the second select box with values of the first tag
                                        log.debug("current value: "+getSelectOptionValue('selection-create-tags-select')); // too early... ui update didn't happen yet
                                        selection_create_form_onSelectTag( getSelectOptionValue('selection-create-tags-select') );
    //                                }                                
                                }
                                function selection_create_form_onSelectTag(tagId) {
                                    log.debug("selection_create_form_onSelectTag: selected tag id: "+tagId);
                                    var tag = ws.findTagByOid(tagId);
                                    log.debug("selection_create_form_onSelectTag: found tag: "+Object.toJSON(tag));
    //                                log.debug("selection_create_form_onSelectTag: rivets forms: "+Object.toJSON(mtwilson.rivets.forms['selection-create-form']));
                                    mtwilson.rivets.forms['selection-create-form'].tagValues.clear().merge(tag.values); 
                                }

                                function selection_create_form_addValue() {
                                    var tag = ws.findTagByOid(getSelectOptionValue('selection-create-tags-select'));
                                    var tagValue = $F('selection-create-tags-values');
                                    mtwilson.rivets.forms['selection-create-form'].input.selection.push({ tag:tag, value: tagValue});  
                                    log.debug("added tag ("+tag.oid+","+tagValue+") to selection: "+Object.toJSON(mtwilson.rivets.forms['selection-create-form'].input.selection));
                                }
                                function selection_create_form_removeValue(tagOid,tagValue) {
                                    var i = mtwilson.rivets.forms['selection-create-form'].input.selection.length;
                                    log.debug("looking through "+i+" selections for value to remove: ("+tagOid+","+tagValue+")");
                                    while(i--) {
                                        if( mtwilson.rivets.forms['selection-create-form'].input.selection[i].tag.oid == tagOid &&  mtwilson.rivets.forms['selection-create-form'].input.selection[i].value == tagValue ) {
                                            mtwilson.rivets.forms['selection-create-form'].input.selection.splice(i,1);
                                        }
                                    }
                                    log.debug("removed tag ("+tagOid+","+tagValue+") from selection: "+Object.toJSON(mtwilson.rivets.forms['selection-create-form'].input.selection));
                                    mtwilson.rivets.views['selection-create-form'].sync(); 
                                }
                                // called when submitting the form... checks that at least one value was added
                                function selection_create_form_validateValues() {
                                    return mtwilson.rivets.forms['selection-create-form'].input.selection.length > 0;
                                }

                            </script>
                            <!--div class="singleDiv"-->
                            <form id="selection-create-form" action="#" onsubmit="return false;">

                                <div class="singleDiv">
                                    <div class="labelDiv">Name : </div>
                                    <div class="valueDiv">
                                        <input type="text" class="textBox_Border" id="selection-create-name" name="name" data-bind-value="input.name" placeholder="Name of this selection">
                                        <span class="requiredField">*</span>
                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv">Tags: </div> <!-- was: "Host Provided By" -->
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="selection-create-tags-select" onchange="selection_create_form_onSelectTag(getSelectOptionValue(this.id));">
                                            <option data-bind-each-item="global.tags" data-bind-text="item.name" data-bind-value="item.oid"></option>
                                        </select>
                                        <select class="ddlBox_small_Border" id="selection-create-tags-values" data-validator="selection_create_form_validateValues">
                                            <option data-bind-each-item="tagValues" data-bind-text="item"></option>
                                        </select>

                                        <input type="button" class="uploadButton" value="Add" id="selection-create-tags-select-add" onclick="selection_create_form_addValue(); return false;"/>
                                    </div>
                                </div>

                                <div class="singleDiv" style="height: 10px;"></div>

                                    <div  class="tableDisplayScroll_small" style="height: 150px;">
                                    <table id="selection-create-tags-table" class="tableDisplay" style="width: 600px;">    
                                        <thead>
                                            <tr>
                                                <th class="row9">Tag name</th>
                                                <th class="row9">Tag OID</th>
                                                <th class="row9">Tag Value</th>
                                                <th class="row12" style="width: 300px;"></th>
                                            </tr>
                                        </thead>
                               
                                        <tbody>
                                            <tr class="evenRow" data-bind-each-item="input.selection">
                                                <td align="center" class="row1" data-bind-text="item.tag.name"></td>
                                                <td align="center" class="row2" data-bind-text="item.tag.oid"></td>
                                                <td align="center" class="row3" data-bind-text="item.value"></td>
                                                <td align="center" class="row4"> <a data-bind-tagOid="item.tag.oid" data-bind-tagValue="item.value" href="#" onclick="javascript:selection_create_form_removeValue(this.getAttribute('tagOid'),this.getAttribute('tagValue'));">remove</a></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    </div>



                                    <div class="singleDiv" style="height: 10px;"></div>                                
                                    <input type="submit" value="Save" onclick="ws.createSelection(this); return false;"/>

                            </form>

                            <div class="singleDiv" style="height: 25px;"></div>
                            <div id="nameOfPage" class="NameHeader">Search Selections</div> 
                            <!--h2>Search Selections</h2-->

                            <form id="selection-search-form" action="#" onsubmit="return false;">

                                <div class="singleDiv">
                                    <div class="labelDiv">Name: </div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="selection-search-name-criteria">
                                            <option value="EqualTo">is</option>
                                            <option value="Contains">contains&nbsp&nbsp&nbsp;</option>
                                        </select>

                                        <input type="text" class="textBox_special_small" id="selection-search-name" name="name" placeholder="Name"/>
                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv">Tag name: </div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="selection-search-tagName-criteria">
                                            <option value="EqualTo">is</option>
                                            <option value="Contains">contains&nbsp&nbsp&nbsp;</option>
                                        </select>

                                        <input type="text" class="textBox_special_small" id="selection-search-tagName" name="tagName" placeholder="Tag name"/>
                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv">Tag OID: </div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="selection-search-tagOid-criteria">
                                            <option value="EqualTo">is</option>
                                            <option value="Contains">starts with</option>
                                        </select>

                                        <input type="text" class="textBox_special_small" id="selection-search-tagOid" name="tagOid" placeholder="Tag OID"/>
                                    </div>
                                </div>

                                 <div class="singleDiv">
                                    <div class="labelDiv">Tag value: </div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="selection-search-tagValue-criteria">
                                            <option value="EqualTo">is</option>
                                            <option value="Contains">contains&nbsp&nbsp&nbsp;</option>
                                        </select>
                                        
                                        <input type="text" class="textBox_special_small" id="selection-search-tagValue" name="tagValue" placeholder="Tag value"/>
                                    </div>
                                </div>

                                <input type="button" class="uploadButton" value="Search..." onclick="ws.searchSelections(this); return false;"/>

                            </form>

                            <div class="singleDiv" style="height: 45px;"></div>
                            <div id="nameOfPage" class="NameHeader">Browse Selections</div> 
                            <!--h2>Browse Selections</h2-->

                            <div class="tableDisplayScroll_small">
                            <table id="selection-browse-table" class="tableDisplayBind" style="width: 620px;">
                            <!--table id="selection-browse-table" class="dataview"-->
                                <thead>
                                    <tr>
                                        <th class="row9">Selection Name</th>
                                        <th class="row9" style="width: 175px;">Tags</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="evenRow" data-bind-each-item="selections">
                                        <td align="center" class="row1" data-bind-text="item.name"></td>
                                        <td align="center" class="row2">
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th class="row9" >Tag Name</th>
                                                        <th class="row9">Tag Value</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="evenRow" data-bind-each-item="item.tags">
                                                        <td align="center" class="row1" data-bind-text="item.tagName"></td>
                                                        <td align="center" class="row2" data-bind-text="item.tagValue"></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </td>
                                        <td align="center" class="row3">
                                            <a data-bind-uuid="item.uuid" href="#" onclick="javascript:ws.removeSelection(this.getAttribute('uuid')); return false;">Delete</a><br>
                                            <a data-bind-uuid="item.uuid" href="#" onclick="javascript:ws.exportXmlSelection(this.getAttribute('uuid')); return false;">Export XML</a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            </div>

                            <!--/div-->

                            <!-- end selections tab -->
                        </div>

                        <div id="certificates">
                            <div class="nagPanel">Manage Certificates &gt;</div>
                            <div id="nameOfPage" class="NameHeader">Create New Certificate Request</div> 


                            <form id="certificate-request-create-form" action="#" onsubmit="return false;">

                                <div class="singleDiv">
                                    <div class="labelDiv">Subject : </div>
                                    <div class="valueDiv">
                                        <input type="text" class="textBox_Border" id="certificate-request-create-subject" name="subject" data-bind-value="input.subject" placeholder="Host UUID">
                                        <span class="requiredField">*</span>
                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv">Tag Selection: </div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="certificate-request-create-tag-selection" data-bind-value="input.selection"> <!-- this is required -->
                                            <option data-bind-each-item="global.selections" data-bind-value="item.uuid" data-bind-text="item.name"></option>
                                        </select>

                                        <input type="submit" class="uploadButton" value="Save" onclick="ws.createCertificateRequest(this); return false;"/>
                                    </div>
                                </div>

                            </form>

                            <div class="singleDiv" style="height: 25px;"></div>
                            <div id="nameOfPage" class="NameHeader">Search Certificate Requests</div> 

                            <form id="certificate-request-search-form" action="#" onsubmit="return false;">


                                <div class="singleDiv">
                                    <div class="labelDiv">Subject: </div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="certificate-request-search-subject-criteria"> 
                                            <option value="EqualTo">is</option>
                                        </select>

                                        <input type="text" class="textBox_special_small" id="certificate-request-search-subject" name="subject" placeholder="Host UUID"/>

                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv">Selection: </div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="certificate-request-search-selection-criteria"> 
                                            <option value="EqualTo">is</option>
                                        </select>

                                        <input type="text" class="textBox_special_small" id="certificate-request-search-selection" name="selection" placeholder="Selection Name or UUID"/>

                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv">Status: </div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="certificate-request-search-status-criteria"> 
                                            <option value="EqualTo">is</option>
                                        </select>
                                        <select class="ddlBox_small_Border" id="certificate-request-search-status"> 
                                            <option value=''>All</option>
                                            <option>New</option>
                                            <option>Pending</option>
                                            <option>Done</option>
                                            <option>Error</option>
                                        </select>

                                        <input type="text" class="textBox_special_small" style="width: 295px;" id="certificate-request-search-selection" name="selection" placeholder="Selection Name or UUID"/>

                                    </div>
                                </div>


                                <input type="button" class="uploadButton" value="Search..." onclick="ws.searchCertificateRequests(this); return false;"/>

                            </form>

                            <div class="singleDiv" style="height: 50px;"></div>
                            <div id="nameOfPage" class="NameHeader">Browse Certificate Requests</div> 
                            <!--h2>Browse Certificate Requests</h2-->

                            <div  class="tableDisplayScroll_small">
                            <table id="certificate-request-browse-table" class="tableDisplayBind" style="width: 600px;">
                                <thead>
                                    <tr>
                                        <th class="row9">Subject (host uuid)</th>
                                        <th class="row9">Selection</th>
                                        <th class="row9">Status</th>
                                        <th class="row12" style="width: 300px;"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="evenRow" data-bind-each-item="certificateRequests">
                                        <td align="center" class="row1" data-bind-text="item.subject"></td>
                                        <td align="center" class="row2" data-bind-text="item.selection"></td>
                                        <td align="center" class="row3" data-bind-text="item.status"></td>
                                        <td align="center" class="row4"><a data-bind-uuid="item.uuid" href="#" onclick="javascript:ws.removeCertificateRequest(this.getAttribute('uuid')); return false;">delete</a></td>
                                    </tr>
                                </tbody>
                            </table>
                            </div>


                            <div class="singleDiv" style="height: 25px;"></div>
                            <div id="nameOfPage" class="NameHeader">Search Certificates</div> 

                            <form id="certificate-search-form" action="#" onsubmit="return false;">

                                <div class="singleDiv">
                                    <div class="labelDiv">Subject: </div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="certificate-search-subject-criteria"> 
                                            <option value="EqualTo">is</option>
                                            <option value="Contains">contains</option>
                                        </select>

                                        <input type="text" class="textBox_Border" style="width: 395px;" id="certificate-search-subject"  name="subject" placeholder="Host UUID"/>

                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv">Issuer: </div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="certificate-search-issuer-criteria"> 
                                            <option value="EqualTo">is</option>
                                            <option value="Contains">contains</option>
                                        </select>

                                        <input type="text" class="textBox_Border" style="width: 395px;" id="certificate-search-issuer" name="issuer" placeholder="Issuer name"/>

                                    </div>
                                </div>

                                 <div class="singleDiv">
                                    <div class="labelDiv">Validity Date: </div> 
                                    <div class="valueDiv">
                                        <select class="ddlBox_small_Border" id="certificate-search-valid-criteria"> 
                                            <option value="On">on</option>
                                            <option value="Before">before</option>
                                            <option value="After">after</option>
                                        </select>

                                        <input type="text" class="textBox_Border" style="width: 395px;" id="certificate-search-valid" name="valid" placeholder="Date" onblur='$(this).value = Date.parse($(this).value).toISOString();'/>
                                        <span class="help">Try "today", "next tuesday", or most reasonable date formats</span>

                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv">SHA-1: </div> 
                                    <div class="valueDiv">
                                        <input type="text" class="textBox_Border" style="width: 395px;" id="certificate-search-sha1" name="sha1" placeholder="Hex (40 characters)"/>
                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv">SHA256: </div> 
                                    <div class="valueDiv">
                                        <input type="text" class="textBox_Border" style="width: 395px;" id="certificate-search-sha256" name="sha256" placeholder="Hex (64 characters)"/>
                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv">PCR Even: </div> 
                                    <div class="valueDiv">
                                        <input type="text" class="textBox_Border" style="width: 395px;" id="certificate-search-pcrEvent" name="pcrEvent" placeholder="Hex (40 characters)"/>
                                    </div>
                                </div>

                                <div class="singleDiv">
                                    <div class="labelDiv">Status: </div> 
                                    <div class="valueDiv">
                                        <input type="hidden" id="certificate-search-revoked-criteria" value=""/>
                                        <select class="ddlBox_small_Border" id="certificate-search-revoked">
                                            <option value="">Any</option>
                                            <option value="false">Active</option>
                                            <option value="true">Revoked</option>
                                        </select>

                                        <input type="button" class="uploadButton" value="Search..." onclick="ws.searchCertificates(this); return false;"/>
                                    </div>
                                </div>

                            </form>


                            <div class="singleDiv" style="height: 25px;"></div>
                            <div id="nameOfPage" class="NameHeader">Browse Certificates</div> 

                            <div  class="tableDisplayScroll_big">
                            <table id="certificate-browse-table" class="tableDisplayBind" style="width: 700px;">
                                <thead>
                                    <tr>
                                        <th class="row9" style="width: 100px;">Subject (Host ID)</th>
                                        <th class="row9" style="width: 100px;">Issuer</th>
                                        <th class="row9" style="width: 100px;">Not Before</th>
                                        <th class="row9" style="width: 100px;">Not After</th>
                                        <th class="row9" style="width: 100px;">Status</th>
                                        <th class="row9" style="width: 100px;">Fingerprint (SHA-1)</th>
                                        <th class="row9" style="width: 100px;">Fingerprint (SHA256)</th>
                                        <th class="row12" style="width: 100px;">Certificate</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="evenRow" data-bind-each-item="certificates">
                                        <td align="center" class="row1" data-bind-text="item.subject"></td>
                                        <td align="center" class="row2" data-bind-text="item.issuer"></td>
                                        <td align="center" class="row3" data-bind-text="item.notBefore | date"></td>
                                        <td align="center" class="row4" data-bind-text="item.notAfter | date"></td>
                                        <td align="center" class="row5" data-bind-text="item.revoked | yesno Revoked Active"></td>
                                        <td align="center" class="row6" data-bind-text="item.sha1 | wrap 16"></td>
                                        <td align="center" class="row7" data-bind-text="item.sha256 | wrap 16"></td>
                                        <td align="center" class="row8">
                                            <a data-bind-uuid="item.uuid" href="#" onclick="javascript:ws.deleteCertificate(this.getAttribute('uuid')); return false;">Delete</a> <br/>
                                            <a data-bind-uuid="item.uuid" href="#" onclick="javascript:$('certificate-provision-uuid').value=this.getAttribute('uuid'); $('certificate-provision-form').show(); return false;">Deploy</a> <br/>
                                            <a href="" onmouseover="$(this).href='data:application/octet-stream;base64,'+($(this).next('span').innerHTML);">Download</a><span style="display:none;" data-bind-text="item.certificate"></span> <br/>
                                            <a data-bind-uuid="item.uuid" href="#" onclick="javascript:ws.deployCertificate(this.getAttribute('uuid')); return false;">Import</a> <br/>
                                            <a data-bind-uuid="item.uuid" href="#" onclick="javascript:ws.revokeCertificate(this.getAttribute('uuid')); return false;">Revoke</a> <br/>                                       
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            </div>

                            <form id="certificate-provision-form" style="display: none;" action="#" onsubmit="return false;" >
                                <p>Currently push-provisioning works only with Citrix Xen hosts.</p>
                                <input type="hidden" name="certificateUuid" id="certificate-provision-uuid"/>
                                <ul>
                                    <li>
                                        <label for="certificate-provision-host">Internet Address</label>
                                        <input type="text" id="certificate-provision-host" name="host" size="40" placeholder="Hostname or IP Address"/>
                                    </li>
                                    <li>
                                        <label for="certificate-provision-username">Username</label>
                                        <input type="text" id="certificate-provision-username" name="username" placeholder="Username"/>
                                    </li>
                                    <li>
                                        <label for="certificate-provision-password">Password</label>
                                        <input type="password" id="certificate-provision-password" name="password" placeholder="Password"/>
                                    </li>
                                    
                                     <li>
                                            <input type="button" value="Provision" onclick="ws.provisionCertificate(this); return false;"/>
                                            <input type="button" value="Cancel" onclick="$('certificate-provision-form').hide(); return false;"/>
                                     </li>
                                </ul>
                            </form>


                        </div> <!-- end certificates tab -->
                   
                        <div id="configure">

                            <form id="configuration-search-form" style="display: none;" onsubmit="return false;">
                                <ul>
                                    <li>
                                        <label for="configuration-search-name">Name</label>
                                        <select id="configuration-search-name-criteria">
                                            <option value="EqualTo">is</option>
                                            <option value="Contains">contains</option>
                                        </select>
                                        <input type="text" id="configuration-search-name" name="name" placeholder="Configuration name, eg 'main'"/>
                                    </li>
                                    <li style="display: none;">
                                        <label for="configuration-search-contentType">Content Type</label>
                                        <input type="hidden" id="configuration-search-contentType-criteria" value="EqualTo"/>
                                        <select id="configuration-search-contentType">
                                            <option>JSON</option>
                                        </select>
                                    </li>
                                    <li><input type="button" value="Search..." onclick="ws.searchConfigurations(this); return false;"/></li>
                                </ul>
                            </form>

                            <div class="nagPanel">Settings &gt;</div>
                            <!--div id="nameOfPage" class="NameHeader">Server Configuration</div--> 

                            <form id="config-form" onsubmit="return false;">
                                <input type="button" id="config-save-button" value="Save" onclick="ws.storeMainConfiguration(this); return false;"/>
                                <input type="button" id="config-load-button" value="Reset" onclick="ws.retrieveMainConfiguration(); return false;"/>

                                <fieldset>
                                        <legend>Server Configuration</legend>
                                <br/>
                                Provisioning
                                <br/>

                                <div class="singleDiv">
                                    <div class="labelDiv">Allow tag selections in certificate requests: </div> 
                                    <div class="valueDiv">
                                        <select data-bind-value="input.allowTagsInCertificateRequests" class="ddlBox_small_Border" id="allow-tags-in-certificate-requests" name="allowTagsInCertificateRequests"> 
                                            <option value="true">Yes</option>
                                            <option value="false">No</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="singleDiv">
                                    <p>Choosing 'Yes' here enables the "Manual" and "Automatic Host-Based" provisioning request models.
                                            Note: for "Automatic Host-Based" provisioning you also need to configure a code signing certificate.</p>
                                </div>

                                <div class="singleDiv" style="height: 25px;"></div>
                                <div class="singleDiv">
                                    <div class="labelDiv">Allow server to automatically select tags for certificate requests: </div> 
                                    <div class="valueDiv">
                                        <select data-bind-value="input.allowAutomaticTagSelection" class="ddlBox_small_Border" id="allow-automatic-tag-selection" name="allowAutomaticTagSelection"> 
                                            <option value="true">Yes</option>
                                            <option value="false">No</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="singleDiv">
                                    <p>Choosing 'Yes' here enables the "Automatic Server-Based" provisioning request models.
                                            Note: for "Automatic Server-Based" provisioning you also need to set a tag selection policy.</p>
                                </div>

                                <div class="singleDiv" style="height: 25px;"></div>
                                <div class="singleDiv">
                                    <div class="labelDiv">Choose a tag selection to use for all certificate requests: </div> 
                                    <div class="valueDiv">
                                        <select data-bind-value="input.automaticTagSelectionName" class="ddlBox_small_Border" id="automatic-tag-selection-name" name="automaticTagSelectionName"> 
                                            <option data-bind-each-item="global.selections" data-bind-value="item.uuid" data-bind-text="item.name"></option> 
                                        </select>
                                    </div>
                                </div>
                                <div class="singleDiv">
                                    <p>If you use "Automatic Server-Based" provisioning, the server needs to know which tag selection
                                            to use for incoming certificate requests. Currently only one tag selection is supported.</p>
                                </div>

                                <div class="singleDiv" style="height: 25px;"></div>
                                <div class="singleDiv">
                                    <div class="labelDiv">Approval Method: </div> 
                                    <div class="valueDiv">
                                        <select data-bind-value="input.approveAllCertificateRequests" class="ddlBox_small_Border" id="approval-method" name="approveAllCertificateRequests"> 
                                            <option value="true">Automatic/internal</option>
                                            <option value="false">Manual/external</option>
                                        </select>
                                    </div>
                                </div>

                                </fieldset>

                                <div class="singleDiv" style="height: 25px;"></div>
                                <fieldset>
                                    <legend>Mt Wilson</legend>

                                    <div class="singleDiv">
                                        <div class="labelDiv">MtWilson Base URL (https://mtwilson:port/) </div> 
                                        <div class="valueDiv">
                                            <input type="text" class="textBox_Border" data-bind-value="mtwilsonUrl" id="mtwilson-url" name="mtwilsonUrl"/>
                                        </div>
                                    </div>

                                    <div class="singleDiv" style="height: 25px;"></div>
                                    <div class="singleDiv">
                                        <div class="labelDiv">MtWilson API Client Username</div> 
                                        <div class="valueDiv">
                                            <input type="text" class="textBox_Border" data-bind-value="mtwilsonClientKeystoreUsername" id="mtwilson-client-keystore-username" name="mtwilsonClientKeystoreUsername"/>
                                        </div>
                                    </div>

                                    <div class="singleDiv" style="height: 25px;"></div>
                                    <div class="singleDiv">
                                        <div class="labelDiv">MtWilson API Client Password</div> 
                                        <div class="valueDiv">
                                            <input type="password" class="textBox_Border" data-bind-value="mtwilsonClientKeystorePassword" id="mtwilson-client-keystore-password" name="mtwilsonClientKeystorePassword"/>
                                        </div>
                                    </div>                               

                                </fieldset>

                            </form>

                             <div class="singleDiv" style="height: 25px;"></div>
                              <!-- since there is a create-ca-key command now, disabling this forma nd just showing the cacerts for import to mt wilson -->
                            <form id="ca-update-form">
                                <fieldset>
                                    <legend>Certificate Authority</legend>
                                    <p>A certificate authority is automatically created during a new install. 
                                        You can update the authority information here. Updating the authority information
                                        will cause the existing certificate authority to be revoked and a new one to be
                                        created with the updated information.</p>
                                    <p>To create a new CA, use the "create-ca-key" command on the asset tag server.</p>
                                    <ul style="display: none;"> 
                                        <li><label for="ca-cn">Common Name</label><input type="text" id="ca-cn" size="30" data-bind-value="input.cn" placeholder="First Name &amp; Last Name" class="required"/></li>
                                        <li><label for="ca-ou">Organizational Unit</label><input type="text" id="ca-ou" size="30" data-bind-value="input.ou" placeholder="Department" value="Cloud Security" class="required"/></li>
                                        <li><label for="ca-o">Organization</label><input type="text" id="ca-o" size="30" data-bind-value="input.o" placeholder="Organization or Company" value="Intel" class="required"/></li>
                                        <li><label for="ca-l">Locality</label><input type="text" id="ca-l" size="30" data-bind-value="input.l" placeholder="City" value="Folsom" class="required"/></li>
                                        <li><label for="ca-st">State</label><input type="text" id="ca-st" size="30" data-bind-value="input.st" placeholder="State or Province" value="CA" class="required"/></li>
                                        <li><label for="ca-c">Country</label><input type="text" id="ca-c" size="30" data-bind-value="input.c" placeholder="Country" value="US" class="required"/></li>
                                        <li><input type="button" value="Update" onclick="ws.updateCertificateAuthority(this);"/></li>
                                    </ul>
                                    <!-- not using data binding right now because we're not supporting updating the file... but we will later to allow user to import external ca certs by just appending them here -->
                                    <textarea id="cacerts-text" rows='20' cols='80'></textarea>
                                </fieldset>
                            </form>

                            <!-- end configure tab -->
                        </div>       
                    </div>

                    <div id="log">
                        <h1>Application Log</h1>
                        <div id="logwindow" style="height: 250px; max-height: 250px; overflow: scroll; border: 2px solid #555555; margin-top: 15px; padding: 4px;">
                        </div>
                        <!-- end log tab -->
                    </div>
                    <!-- content-wrap ends-->	
                </div>
            </div>

            
            <!-- footer starts -->
            <div class="singleDiv" style="height: 25px;"></div>
            <div class="footer" style="display: none;">
                <p>&copy; 2012-2013 Intel Corporation.<br/></p>
            </div>
            <!-- footer ends-->	


        <!-- configure javascript logging -->								
        <script>
            log.attach("logwindow");
        </script>

        <!-- script must be at the end of the markup so it can reference any element -->
        <script>
            // this section initializes the user interface   
            var navTabs = new Control.Tabs('navtabs', {
                activeClassName: 'current',
                setClassOnContainer: true,
                afterChange: function(new_container) {
                    if(new_container.id == 'tags') {
                        //                        onUpdateVoterIssues();
                    }
                    if(new_container.id == 'certificates') {
                        //                        onDisplayTally();
                    }
                }
            });
            
            
            var anchorValue;
            var url = document.location;
            var strippedUrl = url.toString().split("#");
            if(strippedUrl.length > 1)
            anchorvalue = strippedUrl[1];
            navTabs.setActiveTab(anchorvalue);
            
            //navTabs.setActiveTab('tags');
            //navTabs.setActiveTab('certificates');  // for debugging only; normally start with 'tags''
            //$('ajaxstatus').hide();
            $('certificate-provision-form').hide();
        </script>


        <script>
            //log.debug("adapter: "+rivets_watch_findx_adapter);
            //rivets-test
            //var taglist = [ {name:"tag1",oid:"1.1"}, {name:"tag2",oid:"2.2" } ];
            //var taglist = [ "hello", "world" ];
            //var taglist = [ [{name:"hello"}, {name:"world"}] ];
            //var myview = rivets.bind(document.getElementById('rivets-test'), { tags: [ {item:"hello"},{item:"world"}] }); // instead of sampledata.tags
            // *** these were enabled ***
            var alertView, tagview, rdfview, selectionview, tagviewCertificateRequests, certificateView /*, appview */, configurationView;
            //
            //taglist.push("test");
            //myview.build();
            //mybindings.update({filter: mytags});
            //sampledata.tags.push({"name":"new tag","oid":"1.2.3.4","values":["hello","world"]});
            // make sure all dom elements are loaded before initializing the web layer
            document.observe('dom:loaded', function() {
                ws.initialize({
                    options: {
                        baseurl: 'http://localhost:8080'
                    }
                    //views: { 'tags': tagview, 'rdf-triples': rdfview }
    //                data: sampledata, // optional: if not provided will start empty and then we can load it from server
    /*
                    view: { 'update': function(data) {
                            var i = mtwilson.rivets.views.length; // until they respond we don't know what these tags are;  
                            while(i--) {
                                mtwilson.rivets.views[i].update(data);
                            }
    // //                     appview.update(data); 
    //                        tagview.update(data);
    //                        rdfview.update(data);
    //                        selectionview.update(data);
    //  //                      tagviewCertificateRequests.update(data);
    //                        certificateView.update(data); 
    //                        configurationView.update(data);
                        },
                        'sync': function() {
                            var i = mtwilson.rivets.views.length; // until they respond we don't know what these tags are; 
                            while(i--) {
                                mtwilson.rivets.views[i].sync();
                            }
    ////                        appview.sync(); 
    //                        tagview.sync();
    //                        rdfview.sync();
    //                        selectionview.sync();
    // //                       tagviewCertificateRequests.sync();
    //                        certificateView.sync(); 
    //                        configurationView.sync();
                        }
                    }*/
                });
                log.debug("done initializing ws");
            });
            
            //alertView = rivets.bind(document.getElementById('notifications'), ws.data);

//            appview = rivets.bind(document.getElementById('main'), ws.data); 
//            tagview = rivets.bind(document.getElementById('tag-browse-table'), ws.data); 
//            rdfview = rivets.bind(document.getElementById('rdf-triple-browse-table'), ws.data); 
//            selectionview = rivets.bind(document.getElementById('selection-browse-table'), ws.data); 
////            tagviewCertificateRequests = rivets.bind(document.getElementById('certificate-request-create-form'), ws.data); 
//            certificateView = rivets.bind(document.getElementById('certificate-browse-table'), ws.data); 
//            configurationView = rivets.bind(document.getElementById('config-form'), ws.data.currentConfiguration); 

            // wait for the webservice library to initialize, then populate the UI with some data from the server. 
            document.observe('mtwilson:ready', function() {
                log.debug("after init (mtwilson:ready), data: "+Object.toJSON(ws.data));
                ws.searchTags('tag-search-form');
                // ws.searchRdfTriples('rdf-triple-search-form');
                ws.searchSelections('selection-search-form');
                ws.searchConfigurations('configuration-search-form');
                ws.loadCaCerts();
//                ws.retrieveMainConfiguration();
            
            });
            
            
        </script>

    </body>
</html>
